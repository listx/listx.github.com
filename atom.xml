<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Linus's Blog</title>
    <link href="http://listx.github.io/atom.xml" rel="self" />
    <link href="http://listx.github.io" />
    <id>http://listx.github.io/atom.xml</id>
    <author>
        <name>Linus Arver</name>
        <email></email>
    </author>
    <updated>2014-12-13T00:00:00Z</updated>
    <entry>
    <title>Implementing Binary Search</title>
    <link href="http://listx.github.io/post/2014-12-13-implementing-binary-search.html" />
    <id>http://listx.github.io/post/2014-12-13-implementing-binary-search.html</id>
    <published>2014-12-13T00:00:00Z</published>
    <updated>2014-12-13T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-12-13</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-12-13-implementing-binary-search.md" title="History">*</a>
	<br>
	<a href="/tag/programming.html">programming</a>, <a href="/tag/c.html">c</a>, <a href="/tag/ruby.html">ruby</a>, <a href="/tag/haskell.html">haskell</a>
</div>

<p>If you are a programmer, I’m sure you’ve encountered the term <em>binary search</em> at some point in time. I know what binary search is, but I’m writing this post to solidify my understanding of it. I also want to compare how it might be naively implemented across my 3 favorite languages C, Ruby, and Haskell — because naive code is the best code (to learn from)!</p>
<h2 id="binary-subdivision">Binary Subdivision</h2>
<p>You can skip this section if you want — I merely want to write how I first met and fell in love with the concept of <em>binary subdivision</em>. I first discovered binary division when I was in high school. It was a very pleasant realization, and at the time I did not fully realize what I had accidentally encountered.</p>
<p>The situation was so: my Biology teacher, Mr. Kennedy, told everyone to draw an even 4x4 square grid on the palms of our hands. Everyone was supposed to draw their own 4x4 grid — but this was when I asked myself, “how can I draw the most even-looking grid without using a ruler?” You see, I could not use a ruler because I was using my right hand to draw onto my left hand — and to hold a ruler properly I would need a third hand! So there was the problem.</p>
<p>On the one hand, I could not simply draw the four horizontal and four vertical lines one after the other, left to right, top to bottom, because I knew that I would introduce a great deal of additive error.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> I did not want to draw an ugly, lopsided square.</p>
<p>It took me a few seconds, but I came up with a plan. I first drew a single large square. Then knowing that I could easily eyeball with good accuracy where the <em>middle point of that square</em> was horizontally, I drew a vertical line down the <em>middle</em>. I then did the same thing in the other axis vertically. I repeated this procedure a few more times, <em>recursively subdividing</em> each smaller rectangular shape into halves, finally ending up with a nice-looking grid. I glanced around the room, and later looked at other students’ palms to see if they had discovered this “divide by <span class="math">\(\frac{1}{2}\)</span>” trick, but to my dismay no one had done it; I knew this was the case because everybody else’s square was sloppy.</p>
<p>I cannot honestly say if this was the very first time I realized the underlying geometric concepts at play here, but I can affirmatively say that it really was the first time I systematically applied such an elegant solution to a given problem. I wonder if most people who draw grids even bother to think of it as a problem.</p>
<p>To me, binary subdivision is the underpinning principle behind binary search. Continued subdvision by halves is like exponentiation in reverse; pretty soon, you end up with extremely tiny numbers. This is where the power of binary search comes from! Simply put, binary search is like binary subdivision, but you get to subdivide <em>toward</em> the location of whatever you’re looking for. Isn’t that cool?</p>
<h2 id="the-problem">The Problem</h2>
<p>The problem is simple — given a <strong>sorted</strong> list <code>KEYS</code> of items (for simplicity’s sake, positive integers), determine if <code>key</code> is in it, and also, the position of <code>key</code> in the list if it is indeed in the list. The catch is that you have no idea as to the contents of <code>KEYS</code> — only that it is sorted from smallest to largest.</p>
<h2 id="naive-approach-linear-search">Naive Approach — Linear Search</h2>
<p>The simplest way of doing this is by linear search. It is probably the novice programmer’s first reaction. You just start from the first item in <code>KEYS</code>, and run a <strong>for</strong>-loop all the way across the list, looking at every single item. There are now two possibilities — either (1) you indeed discover <code>key</code>, and report back your position (aka the “index”, usually in the form of the familiar <code>i</code> variable in C/C++/Java code), or (2) you find nothing. If you are clever, you can optimize the search in the second situation by breaking out of the <strong>for</strong>-loop if the items you are comparing are larger than <code>key</code>; after all, <code>KEYS</code> is sorted, so we know for a fact that the later numbers are only going to get bigger, so there is no point in trying to find <code>key</code> in that crowd of numbers.</p>
<p>But think of the consequences — what’s the worst case scenario? Imagine you have 1 trillion items, and that <code>key</code> is not in it, because let’s say <code>key</code> is a much bigger number than the biggest number in <code>KEYS</code> — but of course you haven’t run the linear search yet, so you don’t know that. Given this situation, you would have to search the <em>entire</em> list of all numbers in <code>KEYS</code> before reaching condition (2) described above.</p>
<p>If you wanted to get a little more clever to avoid this problem of searching all 1 trillion items, you could tell the algorithm to refuse to enter the <strong>for</strong>-loop if <code>key</code> lies outside the <em>bounds</em> of <code>KEYS</code>. Checking the bounds is easy and takes constant time, as you merely check for the first and last item’s size (again, as <code>KEYS</code> is sorted), and those are your bounds. This way, if <code>key</code> lies outside the bounds, you can <em>guarantee</em> that it is not in <code>KEYS</code>, no matter how many items <code>KEYS</code> has.</p>
<p>And, this is it. There is nothing more to optimize using this method (let’s not get into parallelization). What else can you do, really, when searching linearly, looping through every item from the beginning to the next?</p>
<h2 id="inverted-bounds-checking-aka-binary-search">Inverted Bounds-Checking, aka Binary Search</h2>
<p>The heading of this subsection might have already given you a hint as to what binary search entails. (Although, if you’ve read the <em>Binary Subdivision</em> section, you should have had a good idea anyhow.) Binary search takes the concept of bounds-checking, and applies it repeatedly, recursively, against <code>KEYS</code>. The only difference when I say “bounds-checking” in the context of binary search is that we do <em>not</em> care about the values of those bounds, but merely that they <em>are</em> the bounds. This is because we only concern ourselves with dividing the list of sorted numbers by <span class="math">\(\frac{1}{2}\)</span> every time and take the <em>middle</em> index <code>middle_index</code>, which is located as close as possible to the middle element (halfway between the two bounds). Indeed, the only way to get a valid <code>middle_index</code> value is if we know the bounds (the size of the list). We keep doing this recursively until <code>KEYS[mid] == key</code>.</p>
<p>The following is the pseudocode.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines" input="code/toy/binary-search-pseudo-0.txt"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="sourceCode"><pre><code class="sourceCode">KEYS = some random list of numbers
key = the number we&#39;re looking for in KEYS

binary_search(KEYS, key):
	middle_index = get_middle_index_index(length of KEYS)
	lower_KEYS = get_below(middle_index, KEYS)
	upper_KEYS = get_above(middle_index, KEYS)
	if key &lt; KEYS[middle_index]
		binary_search(lower_KEYS, key)
	else if key &gt; KEYS[middle_index]
		binary_search(upper_KEYS, key)
	else
		return middle_index
	end</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/binary-search-pseudo-0.txt"  mimetype=text/plain > binary-search-pseudo-0.txt </a>
</div>
</div>
<p>There are some obvious holes in the code above.</p>
<p>First, we always assume that <code>KEYS</code> is made up of multiple elements, and that its halves <code>lower_keys</code> and <code>upper_keys</code> also have multiple elements in them. In the extreme case, <code>KEYS</code> might be an empty list, which would make the whole thing explode.</p>
<p>Second, the <code>get_middle_index()</code>, <code>get_below_mid()</code>, and <code>get_above_mid()</code> functions remain undefined.</p>
<p>Aside: You might be wondering about lines 12-14. We could write</p>
<pre><code>else if key == KEYS[mid]</code></pre>
<p>instead of just <code>else</code> on line 12, but that is redundant. This is because we already test for the two other conditions of <code>key</code> being <em>lesser</em> or <em>greater</em> than <code>middle_index</code>. Therefore, we’ve excluded the two other conditions and are already only left with the third condition of <code>key == KEYS[mid]</code> evaluating to TRUE — hence we write just <code>else</code> on line 12.</p>
<p>Addressing the holes above, we get the next version.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<div class="code-and-raw">
<table class="sourceCode numberLines" input="code/toy/binary-search-pseudo-1.txt"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode">KEYS = some random list of numbers
first_index = 0
last_index = 999 (our KEYS is 1000 elements big)
key = the number we&#39;re looking for in KEYS

binary_search(KEYS, key, first_index, last_index):
	list_size = (last_index - first_index) + 1
	if list_size == 0
		return KEY_NOT_FOUND
	end

	middle_index = list_size / 2 + first_index

	if key &lt; KEYS[middle_index]
		binary_search(KEYS, key, first_index, middle_index - 1)
	else if key &gt; KEYS[middle_index]
		binary_search(KEYS, key, middle_index + 1, last_index)
	else
		return middle_index
	end</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/binary-search-pseudo-1.txt"  mimetype=text/plain > binary-search-pseudo-1.txt </a>
</div>
</div>
<p>There are some obvious differences — mainly the fact that we concern ourselves primarily with the first and last index numbers of the list, and work with these indices instead of working with the entire list <code>KEYS</code> itself. The <code>get_below()</code> and <code>get_above()</code> functions are gone and have been replaced with the index bounds <code>first_index, middle_index</code> and <code>middle_index + 1, last_index</code>, respectively. As you can see, working with these index numbers directly avoids a lot of abstraction. Actually, the <code>list_size</code> abstraction can be further reduced in terms of indices, so that <code>list_size == 0</code> can be rewritten as <code>first_index &gt; last_index</code>.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<h2 id="theoretical-performance">Theoretical Performance</h2>
<p>You can probably see why binary search is so powerful. It repeatedly divides the search region into <span class="math">\(\frac{1}{2}\)</span> of its original size. It’s sort of like <a href="http://en.wikipedia.org/wiki/Zeno%27s_paradoxes">Zeno’s Dichotomy Paradox</a>, except that it uses the “absurdity” of Zeno’s argument, and uses that to its advantage. To me, these somewhat related, even tangential, connections make binary search that much more elegant.</p>
<p>Consider this: a list that has 100,000 elements will only take, in the worst case, around 16 calls. Compare that to linear search, which will take at most 100,000 calls or iterations (if our item happens to be at the very last index).<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> The time complexity of binary search for a list of <span class="math">\(\mathit{KEYS\_TOTAL}\)</span> elements is defined to be <span class="math">\(\lfloor\log_2\mathit{KEYS\_TOTAL}\rfloor\)</span>. Because this defines an exponential relationship, we can rest assured that we can <em>cut down</em> a very large list quickly.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<h2 id="naive-implementations">Naive Implementations</h2>
<h3 id="preliminary-details">Preliminary Details</h3>
<p>I said at the beginning of the post that I would show a naive implementation in C, Ruby, and Haskell. I could have simply written a <code>binary_search()</code> function (and only that function) for all three languages — but instead I chose to write full standalone programs for all three that print out the same results. Because they are all standalone programs, you can easily tweak some settings (namely, the <code>KEYS_TOTAL</code> value), and see how it scales.<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> All versions use the new <a href="http://www.pcg-random.org">PCG family</a> of pseudorandom number generators (RNGs), which have been created by Prof. Melissa E. O’Neill, author of the great paper <em>The Genuine Sieve of Eratosthenes</em>.<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a></p>
<h3 id="c-version-linux">C Version (Linux)</h3>
<div class="code-and-raw">
<table class="sourceCode numberLines c" input="code/toy/binary-search.c"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
</pre></td><td class="sourceCode"><pre><code class="sourceCode c"><span class="co">/*</span>
<span class="co"> * LICENSE: PUBLIC DOMAIN</span>
<span class="co"> *</span>
<span class="co"> * Compile with `gcc -o binary-search-c -Wall -Wextra -Wpedantic --std=gnu11 -O2</span>
<span class="co"> * binary-search.c&#39;. Check via valgrind with `valgrind --leak-check=full</span>
<span class="co"> * --show-leak-kinds=all -v path/to/binary&#39;.</span>
<span class="co"> *</span>
<span class="co"> * Usage: just execute the binary as-is without any arguments. To test the RNG,</span>
<span class="co"> * call with the argument &quot;rng&quot;.</span>
<span class="co"> */</span>

<span class="ot">#include &lt;stdbool.h&gt; </span><span class="co">/* bool */</span>
<span class="ot">#include &lt;stdio.h&gt;</span>
<span class="ot">#include &lt;stdint.h&gt; </span><span class="co">/* UINT32_MAX */</span>
<span class="ot">#include &lt;stdlib.h&gt; </span><span class="co">/* malloc() */</span>
<span class="ot">#include &lt;string.h&gt; </span><span class="co">/* strcmp() */</span>
<span class="ot">#include &lt;inttypes.h&gt; </span><span class="co">/* uint32_t */</span>

<span class="kw">typedef</span> <span class="dt">uint32_t</span> u32;
<span class="kw">typedef</span> <span class="dt">uint64_t</span> u64;

<span class="co">/*</span>
<span class="co"> * &quot;-1&quot; is an invalid value to be used as an index for an array (the index</span>
<span class="co"> * number is what binary_search() looks for.)</span>
<span class="co"> */</span>
<span class="kw">enum</span> {KEY_NOT_FOUND = -<span class="dv">1</span>};
<span class="dt">const</span> <span class="dt">int</span> KEYS_TOTAL = <span class="dv">1000000</span>;

<span class="co">// *Really* minimal PCG32 code / (c) 2014 M.E. O&#39;Neill / pcg-random.org</span>
<span class="co">// Licensed under Apache License 2.0 (NO WARRANTY, etc. see website)</span>

<span class="kw">typedef</span> <span class="kw">struct</span> { u64 state;  <span class="dt">uint64_t</span> inc; } pcg32_random_t;

u32 pcg32_random_r(pcg32_random_t *rng)
{
	u64 oldstate = rng-&gt;state;
	rng-&gt;state = oldstate * 6364136223846793005ULL + (rng-&gt;inc|<span class="dv">1</span>);
	u32 xorshifted = ((oldstate &gt;&gt; 18u) ^ oldstate) &gt;&gt; 27u;
	u32 rot = oldstate &gt;&gt; 59u;
	<span class="kw">return</span> (xorshifted &gt;&gt; rot) | (xorshifted &lt;&lt; ((-rot) &amp; <span class="dv">31</span>));
}

u32 uniform32(<span class="dt">int</span> range, pcg32_random_t *rng)
{
	<span class="dt">unsigned</span> rand_limit, rand_excess;
	u32 x;
	rand_excess = ((UINT32_MAX % range) + <span class="dv">1</span>) % range;
	rand_limit = UINT32_MAX - rand_excess;
	<span class="kw">while</span> ((x = pcg32_random_r(rng)) &gt; rand_limit) {};
	<span class="kw">return</span> x % range;
}

<span class="co">/* Populate an array with increasing numbers; we randomly choose whether to skip</span>
<span class="co"> * to the next number by an increment of 1 or 2, so as to initialize the array</span>
<span class="co"> * slightly differently each time this function is called.</span>
<span class="co"> */</span>
u32 init_array(u32 *keys, bool has_key, pcg32_random_t *rng)
{
	<span class="dt">int</span> i, j;
	<span class="kw">for</span> (i = <span class="dv">0</span>, j = <span class="dv">0</span>; i &lt; KEYS_TOTAL; i++) {
		j += uniform32(<span class="dv">2</span>, rng);
		keys[i] = i + j;
	}

	<span class="co">/*</span>
<span class="co">	 * If we want to choose a key, randomly choose one from one of the</span>
<span class="co">	 * existing elements; otherwise, return an impossible key (where</span>
<span class="co">	 * &quot;impossible&quot; means a key whose value lies outside the range of values</span>
<span class="co">	 * that exist in the array).</span>
<span class="co">	 */</span>
	<span class="kw">if</span> (has_key)
		<span class="kw">return</span> keys[uniform32(KEYS_TOTAL, rng)];
	<span class="kw">else</span>
		<span class="co">/* Impossible key = biggest key + 1 */</span>
		<span class="kw">return</span> keys[KEYS_TOTAL - <span class="dv">1</span>] + <span class="dv">1</span>;
}

<span class="dt">int</span> binary_search(u32 *keys, u32 key, <span class="dt">int</span> min, <span class="dt">int</span> max)
{
	<span class="dt">int</span> list_size;
	<span class="dt">int</span> mid;

	list_size = (max - min) + <span class="dv">1</span>;
	<span class="kw">if</span> (list_size == <span class="dv">0</span>)
		<span class="kw">return</span> KEY_NOT_FOUND;

	mid = (list_size / <span class="dv">2</span>) + min;

	<span class="kw">if</span> (key &lt; keys[mid]) {
		<span class="kw">return</span> binary_search(keys, key, min, mid - <span class="dv">1</span>);
	} <span class="kw">else</span> <span class="kw">if</span> (key &gt; keys[mid]) {
		<span class="kw">return</span> binary_search(keys, key, mid + <span class="dv">1</span>, max);
	} <span class="kw">else</span> {
		<span class="kw">return</span> mid;
	}
}

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv)
{
	<span class="dt">int</span> i, min, max;
	<span class="dt">int</span> mid;
	bool has_key;
	u32 *keys;
	u32 key;
	pcg32_random_t rng = {0x1234567890abcdefULL, 0x1234567890abcdefULL};

	<span class="co">/* RNG self-test. */</span>
	<span class="kw">if</span> (argc &gt; <span class="dv">1</span> &amp;&amp; strcmp(argv[<span class="dv">1</span>], <span class="st">&quot;rng&quot;</span>) == <span class="dv">0</span>) {
		printf(<span class="st">&quot;Running RNG self-test.</span><span class="ch">\n</span><span class="st">&quot;</span>);
		printf(<span class="st">&quot;%&quot;</span>PRIu32<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, pcg32_random_r(&amp;rng));
		<span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">1000000</span>; i++) {
			pcg32_random_r(&amp;rng);
		}
		printf(<span class="st">&quot;%&quot;</span>PRIu32<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, pcg32_random_r(&amp;rng));
		<span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">100</span>; i++) {
			printf(<span class="st">&quot;%&quot;</span>PRIu32<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,
				uniform32((UINT32_MAX / <span class="dv">2</span>) + (UINT32_MAX / <span class="dv">3</span>),
				&amp;rng));
		}
		keys = malloc(KEYS_TOTAL * <span class="kw">sizeof</span>(u32));
		<span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; i++) {
			has_key = (bool)uniform32(<span class="dv">2</span>, &amp;rng);
			key = init_array(keys, has_key, &amp;rng);
			printf(<span class="st">&quot;last number in array %d for key %&quot;</span>PRIu32<span class="st">&quot;: &quot;</span>,
				i, key);
			printf(<span class="st">&quot;%&quot;</span>PRIu32<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, keys[KEYS_TOTAL - <span class="dv">1</span>]);
		}
		printf(<span class="st">&quot;Done.</span><span class="ch">\n</span><span class="st">&quot;</span>);
		printf(<span class="st">&quot;END C VERSION</span><span class="ch">\n</span><span class="st">&quot;</span>);
		free(keys);
		<span class="kw">return</span> <span class="dv">0</span>;
	}

	<span class="co">/*</span>
<span class="co">	 * Allocate space for our big array of keys, as well as our</span>
<span class="co">	 * in-place-modified &quot;mid&quot; value.</span>
<span class="co">	 */</span>
	keys = malloc(KEYS_TOTAL * <span class="kw">sizeof</span>(u32));

	<span class="co">/* Stress-test binary_search(). */</span>
	<span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">20</span>; i++) {
		has_key = (bool)uniform32(<span class="dv">2</span>, &amp;rng);
		key = init_array(keys, has_key, &amp;rng);
		min = <span class="dv">0</span>;
		max = KEYS_TOTAL - <span class="dv">1</span>;
		mid = binary_search(keys, key, min, max);
		printf(<span class="st">&quot;%02d - &quot;</span>, i + <span class="dv">1</span>);
		<span class="kw">if</span> (mid == KEY_NOT_FOUND) {
			printf(<span class="st">&quot;key `%&quot;</span>PRIu32<span class="st">&quot;&#39; not found.</span><span class="ch">\n</span><span class="st">&quot;</span>, key);
		} <span class="kw">else</span> {
			printf(<span class="st">&quot;key `%&quot;</span>PRIu32<span class="st">&quot;&#39; found at keys[%d].</span><span class="ch">\n</span><span class="st">&quot;</span>,
				key, mid);
		}
	}

	printf(<span class="st">&quot;END C VERSION</span><span class="ch">\n</span><span class="st">&quot;</span>);
	free(keys);
	<span class="kw">return</span> <span class="dv">0</span>;
}</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/binary-search.c"  mimetype=text/plain > binary-search.c </a>
</div>
</div>
<p>Overview:</p>
<ul>
<li><code>pcg32_random_r()</code> is PCG’s minimal implementation version. This is RNG we depend on to get identical randomly-generated data in the other Ruby and Haskell versions.</li>
<li><code>uniform32()</code> tames all raw RNG’s like <code>pcg32_random_r()</code>; it <a href="2013-07-12-generating-random-numbers-without-modulo-bias.html">removes any bias</a> that might be introduced if we were to use a simple modulo operation. Hence, we use <code>uniform32()</code> for all our RNG needs.</li>
<li><code>init_array()</code> takes an empty array of fixed size, and populates it with semi-random numbers. I say <em>semi-random</em> because the number chosen to populate the array, in sequence, is steadily bumped up with the <code>j</code> variable, <strong>eliminating the need for sorting it afterwards</strong> in preparation for passing it to <code>binary_search()</code>.</li>
<li>Finally, we have <code>binary_search()</code> itself, written in a way to closely match the pseudocode presented above.</li>
</ul>
<p>I’ve tried to keep the code simple. You may find it disturbing that we use the same type for <code>KEY_NOT_FOUND</code> as the actual valid key value (<code>mid</code>) itself. This kind of type overloading is common in C, and is what gives C its bare metal speed — at the cost of (probable) disaster, of course.</p>
<h3 id="ruby-version">Ruby Version</h3>
<div class="code-and-raw">
<table class="sourceCode numberLines ruby" input="code/toy/binary-search.rb"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="co"># LICENSE: PUBLIC DOMAIN</span>

<span class="co"># Interact with `irb -I . -r path/to/this/file&#39;.</span>

<span class="co"># Usage: just execute the binary as-is without any arguments. To test the RNG,</span>
<span class="co"># call with the argument &quot;rng&quot;.</span>

<span class="dt">U32_MAX</span> = <span class="bn">0xffffffff</span>
<span class="dt">U64_MAX</span> = <span class="bn">0xffffffffffffffff</span>
<span class="dt">U32_MOD</span> = <span class="dt">U32_MAX</span> + <span class="dv">1</span>
<span class="dt">U64_MOD</span> = <span class="dt">U64_MAX</span> + <span class="dv">1</span>

<span class="dt">KEYS_TOTAL</span> = <span class="dv">1000000</span>

<span class="kw">class</span> <span class="dt">PCG32</span>
	<span class="ot">@state</span>
	<span class="ot">@inc</span>

	<span class="kw">def</span> initialize(state, inc)
		<span class="ot">@state</span> = state
		<span class="ot">@inc</span> = inc
	<span class="kw">end</span>

	<span class="kw">def</span> pcg32_random_r
		oldstate = <span class="ot">@state</span>
		<span class="ot">@state</span> = (((oldstate * <span class="dv">6364136223846793005</span>) % <span class="dt">U64_MOD</span>) +
			(<span class="ot">@inc</span> | <span class="dv">1</span>)) % <span class="dt">U64_MOD</span>
		xorshifted = (((oldstate &gt;&gt; <span class="dv">18</span>) ^ oldstate) &gt;&gt; <span class="dv">27</span>) % <span class="dt">U32_MOD</span>
		rot = oldstate &gt;&gt; <span class="dv">59</span>
		(xorshifted &gt;&gt; rot) | ((xorshifted &lt;&lt; ((-rot) &amp; <span class="dv">31</span>)) % <span class="dt">U32_MOD</span>)
	<span class="kw">end</span>

	<span class="kw">def</span> uniform32(range)
		rand_excess = ((<span class="dt">U32_MAX</span> % range) + <span class="dv">1</span>) % range
		rand_limit = <span class="dt">U32_MAX</span> - rand_excess
		<span class="kw">while</span> ((x = <span class="dv">self</span>.pcg32_random_r) &gt; rand_limit)
		<span class="kw">end</span>
		x % range
	<span class="kw">end</span>
<span class="kw">end</span>

<span class="kw">def</span> init_array(keys, has_key, rng)
	j = <span class="dv">0</span>
	<span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span>..(<span class="dt">KEYS_TOTAL</span> - <span class="dv">1</span>)
		j += rng.uniform32(<span class="dv">2</span>)
		keys[i] = i + j
	<span class="kw">end</span>

	<span class="kw">if</span> has_key
		keys[rng.uniform32(<span class="dt">KEYS_TOTAL</span>)]
	<span class="kw">else</span>
		keys[<span class="dt">KEYS_TOTAL</span> - <span class="dv">1</span>] + <span class="dv">1</span>
	<span class="kw">end</span>
<span class="kw">end</span>

<span class="kw">def</span> binary_search(keys, key, min, max)
	list_size = (max - min) + <span class="dv">1</span>
	<span class="kw">if</span> (list_size == <span class="dv">0</span>)
		<span class="kw">return</span> <span class="dv">nil</span>
	<span class="kw">end</span>

	mid = (list_size / <span class="dv">2</span>) + min

	<span class="kw">if</span> (key &lt; keys[mid])
		binary_search(keys, key, min, mid - <span class="dv">1</span>)
	<span class="kw">elsif</span> (key &gt; keys[mid])
		binary_search(keys, key, mid + <span class="dv">1</span>, max)
	<span class="kw">else</span>
		mid
	<span class="kw">end</span>
<span class="kw">end</span>

<span class="co"># Begin program</span>

rng = <span class="dt">PCG32</span>.new(<span class="bn">0x1234567890abcdef</span>, <span class="bn">0x1234567890abcdef</span>)

<span class="co"># RNG self-test.</span>
<span class="kw">if</span> (<span class="dt">ARGV</span> == [<span class="st">&quot;rng&quot;</span>])
	puts <span class="st">&quot;Running RNG self-test.&quot;</span>
	puts rng.pcg32_random_r
	<span class="kw">for</span> n <span class="kw">in</span> <span class="dv">0</span>..<span class="dv">999999</span>
		rng.pcg32_random_r
	<span class="kw">end</span>
	puts rng.pcg32_random_r
	<span class="kw">for</span> n <span class="kw">in</span> <span class="dv">0</span>..<span class="dv">99</span>
		puts rng.uniform32((<span class="dt">U32_MAX</span> / <span class="dv">2</span>) + (<span class="dt">U32_MAX</span> / <span class="dv">3</span>))
	<span class="kw">end</span>
	<span class="kw">for</span> n <span class="kw">in</span> <span class="dv">0</span>..<span class="dv">9</span>
		has_key = rng.uniform32(<span class="dv">2</span>) == <span class="dv">1</span>
		keys = []
		key = init_array(keys, has_key, rng)
		puts <span class="st">&quot;last number in array </span><span class="ot">#{</span>n<span class="ot">}</span><span class="st"> for key </span><span class="ot">#{</span>key<span class="ot">}</span><span class="st">: </span><span class="ot">#{</span>keys[<span class="dt">KEYS_TOTAL</span> - <span class="dv">1</span>]<span class="ot">}</span><span class="st">&quot;</span>
	<span class="kw">end</span>
	puts <span class="st">&quot;Done.&quot;</span>
	puts <span class="st">&quot;END RUBY VERSION&quot;</span>
	exit
<span class="kw">end</span>

keys = []

<span class="co"># Stress-test &#39;binary_search&#39; method.</span>
<span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span>..<span class="dv">19</span>
	has_key = rng.uniform32(<span class="dv">2</span>) == <span class="dv">1</span>
	key = init_array(keys, has_key, rng)
	min = <span class="dv">0</span>
	max = <span class="dt">KEYS_TOTAL</span> - <span class="dv">1</span>
	mid = binary_search(keys, key, min, max)
	printf(<span class="st">&quot;%02d - &quot;</span>, i + <span class="dv">1</span>)
	<span class="kw">if</span> mid.nil?
		puts <span class="st">&quot;key `</span><span class="ot">#{</span>key<span class="ot">}</span><span class="st">&#39; not found.&quot;</span>
	<span class="kw">else</span>
		puts <span class="st">&quot;key `</span><span class="ot">#{</span>key<span class="ot">}</span><span class="st">&#39; found at keys[</span><span class="ot">#{</span>mid<span class="ot">}</span><span class="st">].&quot;</span>
	<span class="kw">end</span>
<span class="kw">end</span>
puts <span class="st">&quot;END RUBY VERSION&quot;</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/binary-search.rb"  mimetype=text/plain > binary-search.rb </a>
</div>
</div>
<p>This version, like the Haskell version, tries to follow the C version as much as possible. One drawback of this version is that because Ruby does not support fixed-width integers, we have to make liberal use of the modulo operator <code>%</code> to emulate integer overflow. We could just do a bitwise AND (<code>&amp;</code>) with a mask, but that would risk increased verbosity.</p>
<h3 id="haskell-version">Haskell Version</h3>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/toy/binary-search.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE RecordWildCards #-}</span>

<span class="co">-- LICENSE: PUBLIC DOMAIN</span>
<span class="fu">--</span>
<span class="co">-- Compile with `ghc --make -Wall -Werror -O2 -dynamic -o binary-search-hs</span>
<span class="co">-- binary-search.hs&#39;. For better conformance with the C and Ruby versions, we</span>
<span class="co">-- use snake_case instead of camelCase wherever there is a direct parallel.</span>
<span class="fu">--</span>
<span class="co">-- Interact with `ghci path/to/this/file`.</span>
<span class="fu">--</span>
<span class="co">-- Usage: just execute the binary as-is without any arguments. To test the RNG,</span>
<span class="co">-- call with the argument &quot;rng&quot;.</span>

<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Monad</span>
<span class="kw">import </span><span class="dt">Data.Bits</span>
<span class="kw">import </span><span class="dt">Data.Word</span>
<span class="kw">import </span><span class="dt">System.Environment</span>
<span class="kw">import </span><span class="dt">System.Exit</span>
<span class="kw">import </span><span class="dt">Text.Printf</span>

<span class="ot">u32_max ::</span> <span class="dt">Word32</span>
u32_max <span class="fu">=</span> <span class="bn">0xffffffff</span>

<span class="ot">keys_total ::</span> <span class="dt">Int</span>
keys_total <span class="fu">=</span> <span class="dv">1000000</span>

<span class="kw">data</span> <span class="dt">PCG32</span> <span class="fu">=</span> <span class="dt">PCG32</span>
	{<span class="ot"> state ::</span> <span class="dt">Word64</span>
	,<span class="ot"> inc ::</span> <span class="dt">Word64</span>
	}

<span class="ot">pcg32_random_r ::</span> <span class="dt">PCG32</span> <span class="ot">-&gt;</span> (<span class="dt">Word32</span>, <span class="dt">PCG32</span>)
pcg32_random_r rng<span class="fu">@</span><span class="dt">PCG32</span>{<span class="fu">..</span>} <span class="fu">=</span> (result, rng {state <span class="fu">=</span> state&#39;})
	<span class="kw">where</span>
<span class="ot">	state&#39; ::</span> <span class="dt">Word64</span>
	state&#39; <span class="fu">=</span> state <span class="fu">*</span> <span class="dv">6364136223846793005</span> <span class="fu">+</span> (inc <span class="fu">.|.</span> <span class="dv">1</span>)
<span class="ot">	xorshifted ::</span> <span class="dt">Word32</span>
	xorshifted <span class="fu">=</span> fromIntegral <span class="fu">$</span> shiftR (xor (shiftR state <span class="dv">18</span>) state) <span class="dv">27</span>
<span class="ot">	rot ::</span> <span class="dt">Word32</span>
	rot <span class="fu">=</span> fromIntegral <span class="fu">$</span> shiftR state <span class="dv">59</span>
<span class="ot">	result ::</span> <span class="dt">Word32</span>
	result <span class="fu">=</span> fromIntegral
		<span class="fu">$</span> (shiftR xorshifted <span class="fu">$</span> fromIntegral rot)
			<span class="fu">.|.</span> (shiftL xorshifted <span class="fu">$</span> fromIntegral ((<span class="fu">-</span>rot) <span class="fu">.&amp;.</span> <span class="dv">31</span>))

<span class="ot">uniform32 ::</span> <span class="dt">Word32</span> <span class="ot">-&gt;</span> <span class="dt">PCG32</span> <span class="ot">-&gt;</span> (<span class="dt">Word32</span>, <span class="dt">PCG32</span>)
uniform32 range rng <span class="fu">=</span> find_within_range rng
	<span class="kw">where</span>
<span class="ot">	rand_excess ::</span> <span class="dt">Word32</span>
	rand_excess <span class="fu">=</span> mod ((mod u32_max range) <span class="fu">+</span> <span class="dv">1</span>) range
<span class="ot">	rand_limit ::</span> <span class="dt">Word32</span>
	rand_limit <span class="fu">=</span> u32_max <span class="fu">-</span> rand_excess
	find_within_range rng&#39; <span class="fu">=</span> <span class="kw">if</span> x <span class="fu">&gt;</span> rand_limit
		<span class="kw">then</span> find_within_range rng&#39;&#39;
		<span class="kw">else</span> (mod x range, rng&#39;&#39;)
		<span class="kw">where</span>
		(x, rng&#39;&#39;) <span class="fu">=</span> pcg32_random_r rng&#39;

<span class="ot">init_array ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">PCG32</span> <span class="ot">-&gt;</span> ([<span class="dt">Word32</span>], <span class="dt">Word32</span>, <span class="dt">PCG32</span>)
init_array keys_size has_key rng0 <span class="fu">=</span> (keys, key, rng3)
	<span class="kw">where</span>
	(keys&#39;, rng1) <span class="fu">=</span> genKeysList [] <span class="dv">0</span> <span class="dv">0</span> rng0
	<span class="co">-- Need to reverse the list, because Haskell (like all Lispy languages?)</span>
	<span class="co">-- builds a list backwards when using the cons (:) operator.</span>
	keys <span class="fu">=</span> reverse keys&#39;
<span class="ot">	genKeysList ::</span> [<span class="dt">Word32</span>] <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">PCG32</span> <span class="ot">-&gt;</span> ([<span class="dt">Word32</span>], <span class="dt">PCG32</span>)
	genKeysList arr i j0 rng <span class="fu">=</span> <span class="kw">if</span> i <span class="fu">&lt;</span> keys_size
		<span class="kw">then</span> genKeysList ((i&#39; <span class="fu">+</span> j2&#39;)<span class="fu">:</span>arr) (i <span class="fu">+</span> <span class="dv">1</span>) j2 rng&#39;
		<span class="kw">else</span> (arr, rng)
		<span class="kw">where</span>
		i&#39; <span class="fu">=</span> fromIntegral i
		j2&#39; <span class="fu">=</span> fromIntegral j2
		(j1, rng&#39;) <span class="fu">=</span> uniform32 <span class="dv">2</span> rng
		j2 <span class="fu">=</span> j0 <span class="fu">+</span> fromIntegral j1
	(key, rng3) <span class="fu">=</span> <span class="kw">if</span> has_key
		<span class="kw">then</span>
			<span class="kw">let</span>
				(idx, rng2) <span class="fu">=</span> uniform32 (fromIntegral keys_total) rng1
			<span class="kw">in</span>
			(keys<span class="fu">!!</span>(fromIntegral idx), rng2)
		<span class="kw">else</span> (keys<span class="fu">!!</span>(keys_total <span class="fu">-</span> <span class="dv">1</span>) <span class="fu">+</span> <span class="dv">1</span>, rng1)

<span class="co">-- We use min&#39; and max&#39; because the non-apostrophe versions name-clash with</span>
<span class="co">-- Prelude&#39;s own functions. We could hide Prelude&#39;s imports, but that seems too</span>
<span class="co">-- roundabout.</span>
<span class="ot">binary_search ::</span> [<span class="dt">Word32</span>] <span class="ot">-&gt;</span> <span class="dt">Word32</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Int</span>
binary_search keys key min&#39; max&#39;
	<span class="fu">|</span> list_size <span class="fu">==</span> <span class="dv">0</span> <span class="fu">=</span> <span class="dt">Nothing</span>
	<span class="fu">|</span> key <span class="fu">&lt;</span> keys<span class="fu">!!</span>mid <span class="fu">=</span> binary_search keys key min&#39; (mid <span class="fu">-</span> <span class="dv">1</span>)
	<span class="fu">|</span> key <span class="fu">&gt;</span> keys<span class="fu">!!</span>mid <span class="fu">=</span> binary_search keys key (mid <span class="fu">+</span> <span class="dv">1</span>) max&#39;
	<span class="fu">|</span> otherwise <span class="fu">=</span> <span class="dt">Just</span> mid
	<span class="kw">where</span>
	list_size <span class="fu">=</span> (max&#39; <span class="fu">-</span> min&#39;) <span class="fu">+</span> <span class="dv">1</span>
	mid <span class="fu">=</span> (div list_size <span class="dv">2</span>) <span class="fu">+</span> min&#39;

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
	<span class="kw">let</span>
		rng0 <span class="fu">=</span> <span class="dt">PCG32</span>
			{ state <span class="fu">=</span> <span class="bn">0x1234567890abcdef</span>
			, inc <span class="fu">=</span> <span class="bn">0x1234567890abcdef</span>
			}
	args <span class="ot">&lt;-</span> getArgs
	when (args <span class="fu">==</span> [<span class="st">&quot;rng&quot;</span>]) <span class="fu">$</span> <span class="kw">do</span>
		putStrLn <span class="st">&quot;Running RNG self-test&quot;</span>
		<span class="kw">let</span>
			(num0, rng1) <span class="fu">=</span> pcg32_random_r rng0
		putStrLn <span class="fu">$</span> show num0
		rng2 <span class="ot">&lt;-</span> foldM warmupRng rng1 [<span class="dv">0</span><span class="fu">..</span><span class="dv">999999</span><span class="ot">::</span><span class="dt">Int</span>]
		<span class="kw">let</span>
			(num1, rng3) <span class="fu">=</span> pcg32_random_r rng2
		putStrLn <span class="fu">$</span> show num1
		rng4 <span class="ot">&lt;-</span> foldM testUniform32 rng3 [<span class="dv">0</span><span class="fu">..</span><span class="dv">99</span><span class="ot">::</span><span class="dt">Int</span>]
		_ <span class="ot">&lt;-</span> foldM testArray rng4 [<span class="dv">0</span><span class="fu">..</span><span class="dv">9</span><span class="ot">::</span><span class="dt">Int</span>]
		putStrLn <span class="st">&quot;Done.&quot;</span>
		putStrLn <span class="st">&quot;END HASKELL VERSION&quot;</span>
		exitSuccess
	_ <span class="ot">&lt;-</span> foldM testBinarySearch rng0 [<span class="dv">0</span><span class="fu">..</span><span class="dv">19</span><span class="ot">::</span><span class="dt">Int</span>]
	putStrLn <span class="st">&quot;END HASKELL VERSION&quot;</span>
	<span class="kw">where</span>
	warmupRng rng _ <span class="fu">=</span> return <span class="fu">.</span> snd <span class="fu">$</span> pcg32_random_r rng
	testUniform32 rng _ <span class="fu">=</span> <span class="kw">do</span>
		putStrLn <span class="fu">$</span> show num
		return rng&#39;
		<span class="kw">where</span>
		(num, rng&#39;) <span class="fu">=</span> uniform32 (div u32_max <span class="dv">2</span> <span class="fu">+</span> div u32_max <span class="dv">3</span>) rng
	testArray rng0 i <span class="fu">=</span> <span class="kw">do</span>
		putStrLn <span class="fu">$</span> <span class="st">&quot;last number in array &quot;</span>
			<span class="fu">++</span> show i
			<span class="fu">++</span> <span class="st">&quot; for key &quot;</span>
			<span class="fu">++</span> show key
			<span class="fu">++</span> <span class="st">&quot;: &quot;</span>
			<span class="fu">++</span> show (keys<span class="fu">!!</span>(keys_total <span class="fu">-</span> <span class="dv">1</span>))
		return rng2
		<span class="kw">where</span>
		(res, rng1) <span class="fu">=</span> uniform32 <span class="dv">2</span> rng0
		has_key <span class="fu">=</span> res <span class="fu">==</span> <span class="dv">1</span>
		(keys, key, rng2) <span class="fu">=</span> init_array keys_total has_key rng1
	testBinarySearch rng0 i <span class="fu">=</span> <span class="kw">do</span>
		printf <span class="st">&quot;%02d - &quot;</span> (i <span class="fu">+</span> <span class="dv">1</span>)
		<span class="kw">case</span> foundMid <span class="kw">of</span>
			<span class="dt">Just</span> mid <span class="ot">-&gt;</span> putStrLn <span class="fu">$</span> <span class="st">&quot;key `&quot;</span>
				<span class="fu">++</span> show key
				<span class="fu">++</span> <span class="st">&quot;&#39; found at keys[&quot;</span>
				<span class="fu">++</span> show mid
				<span class="fu">++</span> <span class="st">&quot;].&quot;</span>
			<span class="dt">Nothing</span> <span class="ot">-&gt;</span> putStrLn <span class="fu">$</span> <span class="st">&quot;key `&quot;</span>
				<span class="fu">++</span> show key
				<span class="fu">++</span> <span class="st">&quot;&#39; not found.&quot;</span>
		return rng2
		<span class="kw">where</span>
		(res, rng1) <span class="fu">=</span> uniform32 <span class="dv">2</span> rng0
		has_key <span class="fu">=</span> res <span class="fu">==</span> <span class="dv">1</span>
		(keys, key, rng2) <span class="fu">=</span> init_array keys_total has_key rng1
		min&#39; <span class="fu">=</span> <span class="dv">0</span>
		max&#39; <span class="fu">=</span> keys_total <span class="fu">-</span> <span class="dv">1</span>
		foundMid <span class="fu">=</span> binary_search keys key min&#39; max&#39;</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/binary-search.hs"  mimetype=text/plain > binary-search.hs </a>
</div>
</div>
<p>It pained me not to make use of Haskell’s much faster, efficient <code>Array</code> data structure instead of plain lists (that are constructed with the square brackets <code>[]</code>). And, I have to admit that it is written in a strange style; I’ve preserved the names of the variables from C and Ruby where I could, even though mixing snake_case with camelCase results in utter ugliness. I also restrained myself from using the <code>State</code> monad for keeping track of <code>PCG32</code>’s state. For you non-Haskellers, that means that I manually passed around RNG state (as you can see with <code>rng0</code>, <code>rng1</code>, <code>rng2</code>, etc.) as arguments and return values, because I did not want to place another barrier against quickly grasping the code. Do you really want monad transformers in a “naive” implementation?<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a></p>
<p>The most immediate effect to me when writing the Haskell version was just how stateful the <code>uniform32()</code> and <code>init_array()</code> functions were. The C/Ruby brethren perform lots of variable mutation in those parts, and are consequently difficult to understand from a <em>pure</em> (type system) perspective. All of the silent type promotions in C were blatantly exposed by the Glasgow Haskell Compiler (GHC), making it necessary for me to include all of those explicit <code>fromIntegral</code> type promotions myself in <code>pcg32_random_r</code> and <code>init_array</code>.</p>
<p>But even with all of these explicit conversions and the un-idiomatic Haskell style (excluding coding style), I find the Haskell version much easier to understand. Just compare how clean <code>binary_search</code> looks in Haskell versus the other ones! And the fact that you can basically define nested functions/methods with the <code>where</code> clause makes hole-driven development a piece of cake.</p>
<h2 id="conclusion-and-hopes">Conclusion and Hopes</h2>
<p>I hope you’ve enjoyed looking at the various implementations of binary search. Binary search is certainly something you can write on your own, although getting the surrounding technicalities correct can be a chore — but isn’t that always the case when trying to obvserve the behavior of an algorithm in practice? You can look at the cute 10 or 15-line pseudocode on Wikipedia all day, but how can you be sure that it works? This focus on <strong>real world examples</strong> has been a driving principle behind all of my blog posts, and I hope it has helped you understand the algorithm better.</p>
<p>Binary search is something you can apply in real life, too. For me, I came into contact with it again when I learned about <code>git bisect</code>. I personally try to use binary search myself when I code; for example, if a large block of code does not work, I delete large chunks out, making the deletions ever finer, until I get to the source of the problem. You can think of these examples as binary search, where the key is the (as yet unknown) bad commit or line of code you have to fix. You can be your own algorithm! Isn’t that cool?</p>
<p>Thanks for reading, and happy hacking!</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>It’s like in the children’s <a href="http://en.wikipedia.org/wiki/Chinese_whispers">“Telephone”</a> game, where the error of one person gets magnified at every step, until the end when the message gets so garbled up it becomes comical.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>“Hole-driven-development”, as I like to call it, is a top-down approach to development. You first define the larger pieces, and continuously define the smaller sub-pieces, until you reach atomic pieces (those pieces which cannot be further sub-divided). You might have noticed that this style of writing code has an eerie parallel to the whole (no pun intended!) discussion about binary subdivision, and so forth.</p>
<p>As an aside, in the Haskell community, <em>hole-driven Haskell</em> takes the same approach, but first you define the behaviors of the functions through its type signatures, and leave the implementation details undefined. This way, you can use the compiler’s type system to help you define what you want as you go; this is certainly a step up from <em>unassisted</em> hole-driven development that we are doing with the pseudocode here.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>The condition <code>first_index &gt; last_index</code> might not make sense. This was the pseudocode on Wikipedia at the time I wrote this, and it didn’t make sense to me at first. But think of it this way: binary search involves division of the list into halves, repeatedly. So <code>first_index</code> and <code>last_index</code> get closer and closer to each other. The point is that the distance between these two markers will close, shrinking the list into smaller and smaller subparts. We can’t simply check if these two points meet, by writing <code>first_index == last_index</code>, because of the base case of a 1-element list. Such a list will have <code>first_index</code> as 0, and the <code>last_index</code> as also 0 — because there is only 1 index! In this case, the condition <code>first_index == last_index</code> to check for an empty list is inadequate.</p>
<p>If you look at how we call <code>binary_search()</code> again in lines 15 and 17, you will notice that the new definitions of <code>first_index</code> and <code>last_index</code> depend on <code>middle_index</code>, and it’s this interplay with <code>middle_index</code> that forces <code>last_index</code> to eventually become smaller than <code>first_index</code>. If you work out the algorithm through some small cases, you will see this happen eventually.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Linear search does have the advantage that, on a sorted list, it can take advantage of branch prediction. This is because the <code>if/else</code> test will <em>always go in one direction</em>, until when we get a match or when the element considered is greater than the search key. But in the long run as you increase the search space, binary search will beat linear search hands down.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>However, be mindful to the fact that binary search relies on the input list being sorted. Sorting a list itself is a fundamental problem in computer science, and there are numerous sorting algorithms as well as data structures that make such sorting more amenable. In the real world, I think 90% of your time is going to be spent sorting the list first, by which time the speed benefits of binary search probably won’t hold much influence. If the search space is always small, you could easily get away with linear search — why bother adding complexity where you don’t need it?<a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>You could trivially add on a proper command-line argument handling mechanism. In particular, <code>KEYS_TOTAL</code> is dying to be decoupled from the program’s internals — but I leave that as an exercise to you. (Hint: use a command-line option parsing library!)<a href="#fnref6">↩</a></p></li>
<li id="fn7"><p>MELISSA E. O’NEILL (2009). The Genuine Sieve of Eratosthenes. Journal of Functional Programming, 19, pp 95-106. doi:10.1017/S0956796808007004. <a href="http://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf">Online draft version</a>.<a href="#fnref7">↩</a></p></li>
<li id="fn8"><p>What if I had indeed made use of the <code>State</code> monad, you ask? Well, first I wouldn’t need to pass in, or get back, the RNG state variables. I would just run the RNG-state-changing functions <em>inside</em> the <code>State</code> monad (actually, probably the <code>StateT</code> monad transformer as we’re in the <code>IO</code> monad anyway), to <code>get</code>/<code>put</code> the RNG states to read/write those values.<a href="#fnref8">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>The Parking Lot Problem: A Successor to FizzBuzz?</title>
    <link href="http://listx.github.io/post/2014-09-22-parking-lot-problem.html" />
    <id>http://listx.github.io/post/2014-09-22-parking-lot-problem.html</id>
    <published>2014-09-22T00:00:00Z</published>
    <updated>2014-09-22T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-09-22</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-09-22-parking-lot-problem.md" title="History">*</a>
	<br>
	<a href="/tag/programming.html">programming</a>, <a href="/tag/ruby.html">ruby</a>, <a href="/tag/haskell.html">haskell</a>
</div>

<p>In one of my side projects, I encountered a pair of interesting problems, the first of which which I call the <em>Parking Lot</em> problem, and the sister problem the <em>Parking Load</em> problem. They are but toy problems, but to anyone outside of the programming field, they sound quite complicated!</p>
<p>I’ve provided “Expected Output” sections for you to try out your own solutions against, so don’t be too aggressive with the scrollbar if you want to quiz yourself!</p>
<h2 id="problem-statement">Problem Statement</h2>
<p>Imagine an infinite parking lot, where each parking space is given a natural number, starting with 0, 1, 2, 3, … to infinity. The entire lot is a single row of spaces — so that space <code>0</code> is the one closest to the entrance. There are a finite number of cars randomly parked in the lot, as people come and go as they wish. A new car has just arrived outside the lot, and the driver asks you, <em>“Where is the closest open parking space?”</em></p>
<p>The only information you have is the <em>taken</em> spaces list (<code>T</code>), which lists all the occupied parking spaces. This list is sometimes sorted — sometimes, it is not!</p>
<h2 id="expected-output">Expected Output</h2>
<p>Here is a set of expected inputs and outputs for our problem:</p>
<pre><code>Input -&gt; Output
[] -&gt; 0
[0] -&gt; 1
[0, 1] -&gt; 2
[1] -&gt; 0
[1,2,3] -&gt; 0
[0,1,2,3] -&gt; 4
[0,1,2,3,1000] -&gt; 4</code></pre>
<p>. You may notice that the input list is sorted (for readability), but recall that <code>T</code> <em>may or may not</em> be sorted! Try your own solution against these expected outputs!</p>
<h2 id="some-preliminary-observations">Some Preliminary Observations</h2>
<p>The most important thing here is <code>T</code>. If <code>T</code> is empty, then our parking lot is empty, so the answer is obviously <code>0</code>. In all other cases, we have to figure out the lowest number that is <em>absent</em> from <code>T</code>. Essentially, we can reduce the problem as follows:</p>
<ul>
<li>Find the lowest number not present in the set of integers <code>T</code>, where the lowest possible number is <code>0</code>.</li>
</ul>
<p>I used the metaphor of the parking spaces because it is more memorable, and more importantly, more familiar to the general public.</p>
<h2 id="mathematical-approach">Mathematical Approach</h2>
<p>Conceptually, the problem is very simple. Consider the infinite set <code>N</code>, which includes all natural numbers, starting from <code>0</code>. Then obviously, we can start with <code>N</code> itself, and remove every number in <code>N</code> that is also present in <code>T</code>. Then, when we are done (<code>T</code> is empty), we can look at <code>N</code> and retrieve the lowest number.</p>
<h3 id="sorting">Sorting</h3>
<p>Intuitively, we are really only interested in the first consecutive group of cars parked next to each other. Essentially, what you do is walk along from the very first parking space, <code>0</code>, and see if it is occupied. If it is occupied, you move on to the next space — if it is not occupied, you can stop because you found your answer!</p>
<p>There is no way to solve the problem without first sorting <code>T</code>.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> You can solve the problem without sorting only in the edge case where <code>T</code>’s lowest number is greater than <code>0</code> — i.e., if the car most closely parked to the entrance is not on <code>0</code>, then you do not need to bother sorting <code>T</code>, because the answer is simply <code>0</code>. And, finding the lowest number in a given set is always a <span class="math">\(O(n)\)</span> operation because you need to loop through the entire set just once, keeping track of the lowest number found.</p>
<p>In the more common case (as seen in real life), the parking space closest to the driver (the most desirable parking space) is already taken; and what’s more, the group of spaces closest to the driver is already taken. In this case, we have to proceed from space <code>0</code>, and incrementally observe every subsequent space, until we arrive at an empty parking space. The insight here is that we are treating the multitude of consecutively parked cars as one giant car parked across multiple spaces, and are just trying to find the total number of spaces this car occupies.</p>
<h2 id="ruby">Ruby</h2>
<p>I think it is time for some actual code. While I could explain how the Ruby version works, I feel that I have already expounded upon the problem enough above, so that the code here should make intuitive sense.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines ruby" input="code/toy/parking-space.rb"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">def</span> get_parking_space(t)
	t_sorted = t.sort

	i = <span class="dv">0</span>
	<span class="kw">while</span> i &lt; t_sorted.size
		<span class="kw">if</span> i &lt; t_sorted[i]
			<span class="kw">break</span>
		<span class="kw">end</span>
		i += <span class="dv">1</span>
	<span class="kw">end</span>

	<span class="kw">return</span> i
<span class="kw">end</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/parking-space.rb"  mimetype=text/plain > parking-space.rb </a>
</div>
</div>
<h2 id="haskell">Haskell</h2>
<p>The Haskell version is a direct translation of the Ruby version, as an iterative approach works just fine. The only drawback is that we use <code>Int</code> instead of the arbitrarily large <code>Integer</code> type for succinctness (we can use <code>Integer</code>, but some built-in functions like <code>sort</code> only work on <code>Int</code>). However, it is interesting if only for the fact that the edge cases are made explicit — there seems to be no way to avoid “lying” to Haskell about the complexity of our problem!</p>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/toy/parking-space.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Data.List</span>

<span class="ot">getParkingSpace ::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Int</span>
getParkingSpace ts
	<span class="fu">|</span> null ts <span class="fu">=</span> <span class="dv">0</span>
	<span class="fu">|</span> otherwise <span class="fu">=</span> loop <span class="dv">0</span> <span class="fu">$</span> sort ts
	<span class="kw">where</span>
	loop i xs
		<span class="fu">|</span> i <span class="fu">==</span> length xs <span class="fu">=</span> i
		<span class="fu">|</span> i <span class="fu">&lt;</span> xs <span class="fu">!!</span> i <span class="fu">=</span> i
		<span class="fu">|</span> otherwise <span class="fu">=</span> loop (i <span class="fu">+</span> <span class="dv">1</span>) xs</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/parking-space.hs"  mimetype=text/plain > parking-space.hs </a>
</div>
</div>
<h2 id="low-level-interlude">Low-Level Interlude</h2>
<p>Did you realize that the basic concept here is the same as finding the least significant bit (LSB)? I.e., if the parking lot is one giant computer word, and a <code>1</code> bit represents an available parking space, then we are simply trying to find the LSB (the index of the bit being the same thing as the parking space number). This is such a common scenario, that there are native hardware instructions for this on most all CPUs. The canonical name for this operation is <a href="http://en.wikipedia.org/wiki/Find_first_set"><em>find first set</em></a> or <em>find first one</em>.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> In Linux, you can do <code>man ffs</code> to learn about how to use it in your C program.</p>
<p>Of course, the parking lot in our problem is of infinite size, which makes the size of <code>T</code> arbitrarily large; alas, we cannot use <code>ffs</code> here.</p>
<h1 id="the-parking-load-problem">The Parking Load Problem</h1>
<p>An interesting related problem is what I call the <em>Parking Load</em> problem. The scenario is the same as in the <em>Parking Lot</em> problem, but with the following twist: if the last (most far away) parked car determines the bounds of the parking lot (i.e., it is no longer considered infinitely large), then how many parking spaces are available?</p>
<p>Interestingly, this problem is easier to solve than the first problem. This seems paradoxical — surely, finding the first available parking space is easier than counting every single available space! But it is true — this problem is indeed easier — because we can solve the problem <em>without sorting</em>.</p>
<p>If we talk in terms of our “Low-Level Interlude,” this is essentially the same as saying, “Count the number of <code>1</code> bits.” There are very clever ways of counting bits, but that is not our concern, and so I will present a naive solution in Ruby.</p>
<h2 id="expected-output-1">Expected Output</h2>
<p>Like in the previous problem, below are some expected outputs for you to test your own version against.</p>
<pre><code>Input -&gt; Output
[] -&gt; &quot;N/A&quot;
[0] -&gt; 0
[0,1] -&gt; 0
[0,1,3] -&gt; 1
[999] -&gt; 999
[1,5,999] -&gt; 997</code></pre>
<p>We return “N/A” for the empty case because this condition does not make sense under the terms of the problem, which defines the bounds of the parking lot based on the car farthest away; if there are no cars to begin with, the problem cannot be posed.</p>
<h2 id="ruby-1">Ruby</h2>
<p>Without further ado, here is the Ruby solution.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines ruby" input="code/toy/parking-spaces.rb"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">def</span> get_parking_spaces(t)
	<span class="kw">if</span> t.empty?
		<span class="kw">return</span> <span class="st">&quot;N/A&quot;</span>
	<span class="kw">else</span>
		<span class="kw">return</span> (t.max - t.size) + <span class="dv">1</span>
	<span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/parking-spaces.rb"  mimetype=text/plain > parking-spaces.rb </a>
</div>
</div>
<h2 id="haskell-1">Haskell</h2>
<p>The Haskell version is not much different.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/toy/parking-spaces.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="ot">getParkingSpaces ::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Int</span>
getParkingSpaces t
	<span class="fu">|</span> null t <span class="fu">=</span> <span class="dt">Left</span> <span class="st">&quot;N/A&quot;</span>
	<span class="fu">|</span> otherwise <span class="fu">=</span> <span class="dt">Right</span> <span class="fu">$</span> (maximum t) <span class="fu">-</span> (length t) <span class="fu">+</span> <span class="dv">1</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/parking-spaces.hs"  mimetype=text/plain > parking-spaces.hs </a>
</div>
</div>
<h2 id="a-successor-to-fizzbuzz">A Successor to FizzBuzz?</h2>
<p>For some reason, I get a strong feeling that these problems are much more interesting than <a href="http://en.wikipedia.org/wiki/Fizz_buzz">FizzBuzz</a>. The fact that we talk about an <em>infinitely large</em> parking lot will probably throw a lot of newbies and naive thinkers off the right track. You have to be especially careful about edge cases, such as the empty list in the second Haskell version. I believe that good coders have a keen sense of edge cases, because correct algorithms must withstand them without blowing up. Just review the Haskell solutions and notice all of the edge cases that we have to look out for!</p>
<p>You might even get some crazy answers that consider at length related nonessential tangents and Big-O notation, but fail to realize just how simple, at least conceptually, the problem becomes once you sort <code>T</code>. And, I like these problems more than FizzBuzz because there are so many interesting points about it. For example, you can ask a simple related question: if you were the keeper of this parking lot, what kind of data structure would you use to keep track of the taken parking spaces? And of course, there are very conspicuous low-level analogues that more experienced coders can relate to.</p>
<p>I hope you enjoyed reading about these problems. Maybe you can quiz your friend about it, and see how they respond!</p>
<p>Happy hacking!</p>
<h2 id="update-january-2015">Update: January 2015</h2>
<p>I applied for a job at <a href="http://periscope.io">Periscope</a>, and during the process Tom O’Neill pointed out that the Parking Lot Problem can be solved without sorting using sparse bitsets.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> The idea is pretty simple — each bit represents a parking space, and if it is set to 1, we treat it as occupied, and if it is 0, we treat it as empty. If there are 1,000,000 parking spaces, then we would need 1,000,000 bits. But this is where “sparseness” comes in; if there are a ton of 0’s — say, 50,000 of them — in one spot, we can easily encode that information in fewer bits; the traditional approach is to use run-length encoding (RLE) to do this. E.g., you could write the number “50,000”, and then enclose it in special OP-codes that you reserve to declare that the “50,000” here means something special (in our case, that these 50,000 bits are all zeroes).</p>
<p>Another approach is to use an octree (a tree that always has 8 child nodes), or “Bzets” as coined by the late <a href="http://www.cs.ucla.edu/news/news-archive/2012/2012">Robert Uzgalis</a>, who passed away in 2012. An excellent set of slides are available online if you Google them, but I’ve also uploaded them to my site <a href="http://linusarver.com/upload/grid/file/attachment/fyle/54b437416c30006ac5000000/Bzets.pdf">here</a>. Essentially, the idea is to have a tree with 3 possible values for the child nodes: <code>0 1 T</code>. A <code>0</code> means that you can stop recursing down the tree, as all child nodes, recursively are all set to <code>0</code>. A <code>1</code>, similarly, means you can stop because all child nodes are set to <code>1</code>. A <code>T</code> just means that you have to walk down to the child nodes, because if you gather up all the child nodes’ bits, they are mixed with <code>0</code>s and <code>1</code>s. You can imagine how compact some representations can become. In fact, Uzgalis calls bzets as having logarithmic compression! A <a href="https://github.com/Bovinedragon/Binary-Bzet">project on Github exists</a> that seems to be from one of the 3 UCLA student teams charged with implementing a version of bzets.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>You can, for example, loop from <code>0</code> to infinity and then see if this number exists in <code>T</code> — but this is probably the worst way to solve the problem, at least from a computational perspective. E.g., if it takes <span class="math">\(O(n)\)</span> to search through <code>T</code> to see if some integer <code>i</code> exists in it, then this algorithm has <span class="math">\(O(n^2)\)</span> complexity because you need to run the search for every single integer in <code>T</code>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>A closely related operation is <a href="http://en.wikipedia.org/wiki/Two&#39;s_complement">two’s complement</a> arithmetic. You can read about it from the <a href="http://en.wikipedia.org/wiki/Find_first_set">“Find first set”</a> article on Wikipedia.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>No, I did not get the job. But I did get a free lesson in interviewing over Skype. And I also had a very pleasant conversation about sparse bitsets, and this alone made the whole thing worthwhile.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>My First Contribution to Git</title>
    <link href="http://listx.github.io/post/2014-09-09-my-first-contribution-to-git.html" />
    <id>http://listx.github.io/post/2014-09-09-my-first-contribution-to-git.html</id>
    <published>2014-09-09T00:00:00Z</published>
    <updated>2014-09-09T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-09-09</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-09-09-my-first-contribution-to-git.md" title="History">*</a>
	<br>
	<a href="/tag/programming.html">programming</a>, <a href="/tag/git.html">git</a>
</div>

<p>I am happy to say that my <a href="http://thread.gmane.org/gmane.comp.version-control.git/254705">first</a> <a href="http://thread.gmane.org/gmane.comp.version-control.git/255050">patches</a> were <a href="https://github.com/git/git/commit/4645b014c5c82a3b75337">recently merged</a> into the master Git branch! Now, I am by no means a C or Git expert, so the patches only dealt with changes to the documentation. I did not know anyone involved with Git in real life; nor did I have any experience submitting patches to a big project like Git. So, how did I do it?</p>
<h2 id="dead-simple-fix">Dead Simple Fix</h2>
<p>It all started when I typed in <code>man git init</code> and found this line:</p>
<pre><code>The template directory used will (in order):</code></pre>
<p>. Obviously, there was a missing word “be” in that sentence. I could not believe that such a glaring error was present in such a high profile project like Git. Then again, if you think about it, you only invoke <code>git init</code> once per project (to initialize a Git repository), so the vast majority of users have but a cursory glance at the manpage — that is, if they even bother at all to consult the manpages for such a basic task.</p>
<p>Anyway, my initial reaction was “Aha! I will fix this typo and submit my first patch to Git!”. I thought fixing something so simple and obvious would surely have no trouble getting into the main branch. But then, something stirred inside me, and compelled me to look for similar errors in the manpage. Judging by the pace of things, my next patch to Git might take one, two, five years (or forever?), and the thought of becoming a one-shot, one-commit, one-word-fix contributor made my ego twitch. And besides, it felt a bit stupid to just submit a two-letter (“b” and “e”) fix. I thought to myself, “Maybe there are other low-hanging fruits to pluck?”</p>
<h2 id="real-work">Real Work</h2>
<p>So, I set a medium-term goal to myself: read the entire <code>git init</code> manpage, with a singular focus on clarity. I spotted more typographical errors, and even some confusing parts that a Git newbie would have trouble with. <code>git init</code>, after all, is a very basic, fundamental operation that all newcomers to Git would probably have questions about. It might even be the first thing that newbies might look up in the docs!</p>
<p>First things first. I cloned the <a href="https://github.com/git/git">master Git repository</a> from GitHub. I then created a new branch to record my work; in the end, I created 7 commits. I read Git’s documentation on how to submit patches, and also consulted contribution advice for the Linux Kernel project in the form of <a href="http://youtu.be/LLBrBBImJt4">Greg Kroah-Hartman’s excellent talk</a>. The Linux Kernel is where Git’s real action is (tens of thousands of contributors, all using Git!), so it made sense to check out the Kernel’s way of doing things.</p>
<p>I used <code>git rebase -i</code> countless times until I got everything sorted out. I even reordered the commits to have the <a href="https://github.com/git/git/commit/6e1ccacbedf084971f095816f4450c4b607607c5">most basic one</a> (all typographical changes) be the first one, in case they wanted to merge just a few of them and reject the rest.</p>
<p>After re-reading everything for the eighth time, I sent an email to the official mailing list with <code>git send-email</code>. I checked <code>git blame</code> for the lines I touched to CC everyone that could be directly affected by my changes. After a few days, I got a response back — from the principal maintainer of Git, Junio Hamano, no less!</p>
<h2 id="the-response">The Response?</h2>
<p>He was very polite, and true to his duty as maintainer, very thorough. You can see the discussion that took place over at the <a href="http://thread.gmane.org/gmane.comp.version-control.git/254705">mailing list archive</a>. I sent off my second version of my 7-commit patch series after a few days, and waited.</p>
<p>And waited. I waited two weeks, but alas, my new patch series was not getting any further feedback. I was concerned that my changes were simply forgotten. A nagging thought annoyed me — “What if I miss the current merge window<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>?” In mild desperation, I sent an email directly to Junio to remind him about my patches. Still no response. A couple more weeks passed, and I almost forgot about my patches…</p>
<p>Until today! I got an email from <code>tip4commit.com</code> telling me that I was given some miniscule fraction of a bitcoin for my contribution to the Git project. It felt like some strange sort of scam, but even if it was, whoever wrote that automated emailing script did their homework on the Github API because lo and behold, my patches were indeed merged into the mainline!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Well, as they say, if you don’t know how to code but still want to contribute to an open source project, you should work on the documentation! I assume that I did not get any feedback after the initial code review because the maintainer, Junio, was busy with other matters. If I think about it now, he does get tons of patches and needs to do countless merges, containing countless commits, to make a new release of Git.</p>
<p>So, when contributing to open source, try working on the documentation first. Improving the documentation not only benefits all newcomers to the project, but also helps you understand the project better — a win win! And, be patient with your patches — especially if the project you are contributing to has a busy schedule.</p>
<p>Happy hacking!</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>This is the period of time when the maintainer of a project accepts patches for the next release.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>Reverse Polish Notation (RPN) Calculator in Ruby and Haskell</title>
    <link href="http://listx.github.io/post/2014-09-05-rpn-calculator.html" />
    <id>http://listx.github.io/post/2014-09-05-rpn-calculator.html</id>
    <published>2014-09-05T00:00:00Z</published>
    <updated>2014-09-05T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-09-05</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-09-05-rpn-calculator.md" title="History">*</a>
	<br>
	<a href="/tag/programming.html">programming</a>, <a href="/tag/ruby.html">ruby</a>, <a href="/tag/haskell.html">haskell</a>
</div>

<p>A friend of mine is in DevBootCamp, an intensive coding school program designed to get students ready for real world job placement. Anyway, he was telling me how he was given an extra credit assignment: implement a RPN calculator which supports 3 functions — add, subtract, and multiply — on integer numbers. I.e., write a function <code>evaluate()</code> that when given a string such as <code>&quot;3 4 + 8 *&quot;</code> gives the result <code>56</code>. He gave me his Ruby solution; in response, I wrote my own Ruby version and decided soon thereafter to write an equivalent Haskell version, because, why not?</p>
<h2 id="ruby">Ruby</h2>
<p>First, the Ruby version:</p>
<div class="code-and-raw">
<table class="sourceCode numberLines ruby" input="code/toy/rpn.rb"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">def</span> evaluate(equation_str)
	stack = []
	equation_str.split.each <span class="kw">do</span> |term|
		<span class="kw">case</span> term
		<span class="kw">when</span> <span class="ot">/^\d+?$/</span>
			stack.push(term.to_i)
		<span class="kw">when</span> <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;*&quot;</span>
			<span class="kw">if</span> stack.size &lt; <span class="dv">2</span>
				raise <span class="st">&quot;stack too small for operator application&quot;</span>
			<span class="kw">else</span>
				b = stack.pop
				a = stack.pop
				op = term.to_sym
				c = b.send(op, a)
				stack.push(c)
			<span class="kw">end</span>
		<span class="kw">else</span>
			raise <span class="st">&quot;invalid input `</span><span class="ot">#{</span>term<span class="ot">}</span><span class="st">&#39;&quot;</span>
		<span class="kw">end</span>
	<span class="kw">end</span>
	stack
<span class="kw">end</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/rpn.rb"  mimetype=text/plain > rpn.rb </a>
</div>
</div>
<p>Pretty straightforward, yes? The <code>terms</code> variable holds an array of numbers and operators. We use a calculator stack (aptly named, <code>stack</code>) to untangle the RPN in a stack-based way.</p>
<p>In the <code>each</code> loop, the actions depend on what <code>term</code> looks like. If <code>term</code> is a number in string form, we convert it into a real number with <code>String#to_i</code>, and push it into <code>stack</code>. If <code>term</code> is one of the 3 recognized operators, we remove 2 terms <code>a</code> and <code>b</code> from <code>stack</code> and apply the necessary operation on it with Ruby’s magic <code>Object#send</code> method, and push the new term <code>c</code> back into <code>stack</code> for further operations (if any, in later iterations of the <code>while</code> loop). Otherwise, we reject the input as an invalid term.</p>
<h2 id="haskell">Haskell</h2>
<p>Here is the Haskell version:</p>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/toy/rpn.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Data.Char</span> (isDigit)

<span class="kw">data</span> <span class="dt">Term</span>
	<span class="fu">=</span> <span class="dt">TermInt</span> <span class="dt">Integer</span>
	<span class="fu">|</span> <span class="dt">TermOp</span> (<span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">Integer</span>)

<span class="ot">evaluate ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> [<span class="dt">Integer</span>]
evaluate <span class="fu">=</span> evalTerms <span class="fu">.</span> map mkTerm <span class="fu">.</span> words

<span class="ot">mkTerm ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Term</span>
mkTerm termStr <span class="fu">=</span> <span class="kw">case</span> termStr <span class="kw">of</span>
	<span class="st">&quot;+&quot;</span> <span class="ot">-&gt;</span> <span class="dt">TermOp</span> (<span class="fu">+</span>)
	<span class="st">&quot;-&quot;</span> <span class="ot">-&gt;</span> <span class="dt">TermOp</span> (<span class="fu">-</span>)
	<span class="st">&quot;*&quot;</span> <span class="ot">-&gt;</span> <span class="dt">TermOp</span> (<span class="fu">*</span>)
	_
		<span class="fu">|</span> and <span class="fu">$</span> map isDigit termStr <span class="ot">-&gt;</span> <span class="dt">TermInt</span> <span class="fu">$</span> read termStr
		<span class="fu">|</span> otherwise <span class="ot">-&gt;</span> error <span class="fu">$</span> <span class="st">&quot;invalid input `&quot;</span> <span class="fu">++</span> termStr <span class="fu">++</span> <span class="st">&quot;&#39;&quot;</span>

<span class="ot">evalTerms ::</span> [<span class="dt">Term</span>] <span class="ot">-&gt;</span> [<span class="dt">Integer</span>]
evalTerms <span class="fu">=</span> foldl modifyStack []
	<span class="kw">where</span>
	modifyStack stack term <span class="fu">=</span> <span class="kw">case</span> term <span class="kw">of</span>
		<span class="dt">TermInt</span> n <span class="ot">-&gt;</span> n <span class="fu">:</span> stack
		<span class="dt">TermOp</span> op <span class="ot">-&gt;</span> <span class="kw">case</span> stack <span class="kw">of</span>
			(a<span class="fu">:</span>b<span class="fu">:</span>_) <span class="ot">-&gt;</span> op a b <span class="fu">:</span> drop <span class="dv">2</span> stack
			_ <span class="ot">-&gt;</span> error <span class="st">&quot;stack too small for operator application&quot;</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/toy/rpn.hs"  mimetype=text/plain > rpn.hs </a>
</div>
</div>
<p>Probably the first thing to note is that we define a robust data type, <code>Term</code>, to encapsulate the values held in a given RPN string. We take advantage of Haskell’s functions-as-first-class-values ability, and define the <code>TermOp</code> constructor with it (i.e., it needs an arithmetic function <code>(Integer -&gt; Integer -&gt; Integer)</code> as an argument).</p>
<p>The next thing to notice is that the <code>evaluate</code> function is composed of smaller helper functions, <code>mkTerm</code> and <code>evalTerms</code>. <code>mkTerm</code> simply converts a <code>String</code> type into an appropriate <code>Term</code> type. <code>evalTerms</code> takes a list of <code>Term</code> values, and reduces it as much as possible by applying the <code>modifyStack</code> function over it with <code>foldl</code> (Haskell’s version of a single-pass loop).</p>
<p>When <code>modifyStack</code> encounters a <code>TermInt</code>, it pushes the number into the stack. When it encounters a <code>TermOp</code>, it applies that operator to the first 2 items in <code>stack</code>, and pushes this result back into <code>stack</code>. We use pattern matching with <code>(a:b:_)</code> to pull out the <code>a</code> and <code>b</code> values from the stack — the expression <code>(a:b:_)</code> means a value that matches either <span class="math">\([x_1, x_2]\)</span>, or <span class="math">\([x_1, x_2, ... , x_n]\)</span>, because the <code>_</code> operator matches anything, including the empty list <code>[]</code> used to finalize list creation. The <code>drop 2 stack</code> is necessary because Haskell’s types by default are immutable.</p>
<h2 id="thoughts">Thoughts</h2>
<p>I much prefer the Haskell version.</p>
<p>The separation of concerns is a big win — we can easily create helper functions like <code>mkTerm</code> and <code>evalTerms</code> because of Haskell’s purity<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. Haskell embraces the use of algebraic data types (i.e., <code>Term</code> here), and perhaps this preference lends itself to the use of helper functions that convert things from one type to another. Ruby does not have types, at least in the sense of Haskell types, so to artificially create such concepts and to implement them would be difficult.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> I mean, I really want to write equivalent <code>mkTerm</code> and <code>evalTerms</code> methods in Ruby, but my beginner skills prevent me from doing it in a simple, straightforward way. I know enough about coding to abandon “solutions” that require circuitous, complex design.</p>
<p>I also like how all the functions are pure and thus easy to reason about with the type signatures. Refactoring code like this is a dream.</p>
<p>In short, algebraic data types, the clean delegation of subtasks to helper functions, and purity make the Haskell version easier to reason about and maintain in the long run.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Haskell’s <em>purity</em> is a term of art. Look it up!<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>The closest thing to Haskell types in Ruby, in my mind, are Ruby objects. Certainly, Ruby knows the difference between two objects belonging to different classes, but to do that here would make the code much longer and offer little benefit.<a href="#fnref2">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>Find Lines with 80+ Columns in Multiple Files</title>
    <link href="http://listx.github.io/post/2014-08-11-find-files-with-80%2B-columns.html" />
    <id>http://listx.github.io/post/2014-08-11-find-files-with-80%2B-columns.html</id>
    <published>2014-08-11T00:00:00Z</published>
    <updated>2014-08-11T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-08-11</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-08-11-find-files-with-80+-columns.md" title="History">*</a>
	<br>
	<a href="/tag/linux.html">linux</a>, <a href="/tag/programming.html">programming</a>
</div>

<p>It’s nice to follow the 80-columns-per-line rule<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, but what if you have some lingering project that has yet to conform?</p>
<p>Just go to that project’s sources directory and do</p>
<div class="code-and-raw">
<table class="sourceCode numberLines bash" input="code/find-80-cols.sh"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode bash"><span class="kw">find</span> . -type f -exec sh -c <span class="st">&quot;expand -t 8 {} | grep -n </span><span class="dt">\&quot;</span><span class="st">.\{81\}</span><span class="dt">\&quot;</span><span class="st">&quot;</span> <span class="dt">\;</span> -print</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/find-80-cols.sh"  mimetype=text/plain > find-80-cols.sh </a>
</div>
</div>
<p>.</p>
<p>The call to <code>expand</code> is necessary because different people use different widths for tabs. That is, we are trying to find files with 80+ <em>columns</em> (as they appear to humans), not 80+ <em>characters</em> (as they appear to the computer).</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>See the <a href="https://www.kernel.org/doc/Documentation/CodingStyle">Linux Kernel Coding Style</a>, “Chapter 2: Breaking long lines and strings”.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>Solving the "NVRM: API mismatch" Problem on Arch Linux</title>
    <link href="http://listx.github.io/post/2014-06-04-nvrm-api-mismatch.html" />
    <id>http://listx.github.io/post/2014-06-04-nvrm-api-mismatch.html</id>
    <published>2014-06-04T00:00:00Z</published>
    <updated>2014-06-04T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-06-04</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-06-04-nvrm-api-mismatch.md" title="History">*</a>
	<br>
	<a href="/tag/arch.html">arch</a>, <a href="/tag/linux.html">linux</a>, <a href="/tag/nvidia.html">nvidia</a>
</div>

<p>Sometimes when you do a system upgrade on Arch, Xorg will die on a reboot and you’ll get this kernel error (available with <code>dmesg</code>):</p>
<table class="sourceCode numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode">NVRM: API mismatch: the client has the version XXX.XX, but
NVRM: this kernel module has the version YYY.YY.  Please
NVRM: make sure that this kernel module and all NVIDIA driver
NVRM: components have the same version.</code></pre></td></tr></table>
<p>. This is usually the case when you upgrade your <code>linux</code> package, followed by upgrading your <code>nvidia</code> package. The problem is that the new kernel image references your older <code>nvidia</code> package (when it executed <code>mkinitcpio -p linux</code> before <code>nvidia</code> got upgraded). There are two possible solutions:</p>
<ol style="list-style-type: decimal">
<li>Simply remake your kernel image against your newly upgraded <code>nvidia</code> package. Run <code>mkinitcpio -p linux</code> again, and reboot.</li>
<li>In the alternative, downgrade to your previous set of <code>nvidia</code> drivers, located in <code>/var/cache/pacman/pkg/</code>.</li>
</ol>
<p>Hope this helps someone out there. =)</p>
]]></summary>
</entry>
<entry>
    <title>Quad Monitor Setup</title>
    <link href="http://listx.github.io/post/2014-05-20-quad-monitor-setup.html" />
    <id>http://listx.github.io/post/2014-05-20-quad-monitor-setup.html</id>
    <published>2014-05-20T00:00:00Z</published>
    <updated>2014-05-20T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-05-20</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-05-20-quad-monitor-setup.md" title="History">*</a>
	<br>
	<a href="/tag/linux.html">linux</a>, <a href="/tag/hardware.html">hardware</a>, <a href="/tag/nvidia.html">nvidia</a>, <a href="/tag/xmonad.html">xmonad</a>
</div>

<p>I got my two QNIX QX2710 LED Evolution II SE Matte 27&quot; 2560x1440 Samsung PLS WQHD monitors and incorporated them into my existing dual Acer X222W 22&quot; 1680x1050 setup. I put the two QNIXes in the middle, and put the Acers on the left and right edges. All four are in “portrait” orientation, because I primarily code on my computer. A single Gigabyte GeForce GTX 750 Ti OC 2GB GDDR5 2DVI/2HDMI card powers all four monitors; the QNIXes use the DVI ports, while the Acers use the HDMI ports via two HDMI-to-DVI(female) adapters. I bought this card because of the simplicity of the four ports — just DVI and HDMI.</p>
<p>As for the stands, I just bought another dual monitor stand and put it next to my existing dual monitor stand; each stand holds a QNIX and an Acer on each arm. The fact that the stands are subject to differently weighted monitors (27&quot; monitor on one arm and a 22&quot; on another) does not really affect them negatively. The desk in the image below is 140mm wide, in case you want to have a sense of how tight two dual-monitor stands would fit on your own desk.</p>
<p><img src="../img/quad-monitor.jpg" alt="Quad monitor setup" title="Quad monitor setup" width="100%"></p>
<p>Using four monitors sounds difficult, but it’s a breeze with Xinerama and Xmonad. The hardest part was figuring out the correct <code>xorg.conf</code> configuration file. It was difficult because the QNIX monitors, being cheap, do not work out of the box, because the latest Nvidia driver (version 337.12) does not detect the correct resolution. What’s worse, the QNIXes do not support anything other than their native 2560x1440 resolution, so you’ll get blank screens if you try to just use these monitors without tweaking some <code>xorg.conf</code> settings. I actually ended up googling to find the correct <code>Modeline</code> value for <code>xorg.conf</code> for my QNIX, at 96hz refresh rate.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> You could try using the <code>cvt</code> program included with <code>xorg-server</code>, but when I tried it out on my own it generated different numbers and my QNIXes couldn’t handle those numbers.</p>
<p>Here is my <code>xorg.conf</code>:</p>
<div class="code-and-raw">
<table class="sourceCode numberLines xorg" input="code/quad-monitor-portrait.xorg.conf"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre></td><td class="sourceCode"><pre><code class="sourceCode xorg">#<span class="co"> nvidia-settings: X configuration file generated by nvidia-settings</span>
#<span class="co"> nvidia-settings:  version 337.12  (buildmeister@swio-display-x64-rhel04-11)  Fri Apr  4 15:17:43 PDT 2014</span>

<span class="fu">Section</span> <span class="st">&quot;ServerLayout&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Layout0&quot;</span>
    Screen<span class="kw">      </span><span class="dv">0</span><span class="kw">  </span><span class="dt">&quot;Qnix1&quot;</span><span class="kw"> </span><span class="dv">2490</span><span class="kw"> </span><span class="dv">0</span>
    Screen<span class="kw">      </span><span class="dv">1</span><span class="kw">  </span><span class="dt">&quot;Acer1&quot;</span><span class="kw"> </span><span class="dv">3930</span><span class="kw"> </span><span class="dv">300</span>
    Screen<span class="kw">      </span><span class="dv">2</span><span class="kw">  </span><span class="dt">&quot;Acer2&quot;</span><span class="kw"> </span><span class="dv">0</span><span class="kw"> </span><span class="dv">300</span>
    Screen<span class="kw">      </span><span class="dv">3</span><span class="kw">  </span><span class="dt">&quot;Qnix2&quot;</span><span class="kw"> </span><span class="dv">1050</span><span class="kw"> </span><span class="dv">0</span>
    Option<span class="kw">         </span><span class="dt">&quot;Xinerama&quot;</span><span class="kw"> </span><span class="dt">&quot;1&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Monitor&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Monitor0&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;QNIX&quot;</span>
    ModelName<span class="kw">      </span><span class="dt">&quot;QX2710&quot;</span>
    DisplaySize<span class="kw">     </span><span class="dv">597</span><span class="kw">    </span><span class="dv">336</span>
    HorizSync<span class="kw">       </span><span class="fl">88.8</span><span class="kw"> - </span><span class="fl">160.0</span>
    VertRefresh<span class="kw">     </span><span class="fl">59.5</span><span class="kw"> - </span><span class="fl">120.0</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440&quot;</span><span class="kw">          </span><span class="fl">241.50</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2608</span><span class="kw"> </span><span class="dv">2640</span><span class="kw"> </span><span class="dv">2720</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1481</span><span class="kw"> +</span><span class="ot">hsync</span><span class="kw"> -</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_60&quot;</span><span class="kw">       </span><span class="fl">312.25</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2752</span><span class="kw"> </span><span class="dv">3024</span><span class="kw"> </span><span class="dv">3488</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1493</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_75&quot;</span><span class="kw">       </span><span class="fl">397.25</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2760</span><span class="kw"> </span><span class="dv">3040</span><span class="kw"> </span><span class="dv">3520</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1506</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_85&quot;</span><span class="kw">       </span><span class="fl">454.75</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2768</span><span class="kw"> </span><span class="dv">3048</span><span class="kw"> </span><span class="dv">3536</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1514</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_96&quot;</span><span class="kw">       </span><span class="fl">400.00</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2608</span><span class="kw"> </span><span class="dv">2640</span><span class="kw"> </span><span class="dv">2744</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1512</span><span class="kw"> +</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPMS&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Monitor&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Monitor1&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;Unknown&quot;</span>
    ModelName<span class="kw">      </span><span class="dt">&quot;Acer X222W&quot;</span>
    HorizSync<span class="kw">       </span><span class="fl">31.0</span><span class="kw"> - </span><span class="fl">81.0</span>
    VertRefresh<span class="kw">     </span><span class="fl">56.0</span><span class="kw"> - </span><span class="fl">75.0</span>
    #<span class="co"> Generated via &quot;cvt 1680 1050&quot; with the Acer monitor plugged in; `cvt` is</span>
    #<span class="co"> part of xorg-server 1.15.1-1 package on Arch Linux</span>
    ModeLine<span class="kw"> </span><span class="dt">&quot;1680x1050_60.00&quot;</span><span class="kw">  </span><span class="fl">146.25</span><span class="kw">  </span><span class="dv">1680</span><span class="kw"> </span><span class="dv">1784</span><span class="kw"> </span><span class="dv">1960</span><span class="kw"> </span><span class="dv">2240</span><span class="kw">  </span><span class="dv">1050</span><span class="kw"> </span><span class="dv">1053</span><span class="kw"> </span><span class="dv">1059</span><span class="kw"> </span><span class="dv">1089</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPMS&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Monitor&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Monitor2&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;Unknown&quot;</span>
    ModelName<span class="kw">      </span><span class="dt">&quot;Acer X222W&quot;</span>
    HorizSync<span class="kw">       </span><span class="fl">31.0</span><span class="kw"> - </span><span class="fl">81.0</span>
    VertRefresh<span class="kw">     </span><span class="fl">56.0</span><span class="kw"> - </span><span class="fl">75.0</span>
    ModeLine<span class="kw"> </span><span class="dt">&quot;1680x1050_60.00&quot;</span><span class="kw">  </span><span class="fl">146.25</span><span class="kw">  </span><span class="dv">1680</span><span class="kw"> </span><span class="dv">1784</span><span class="kw"> </span><span class="dv">1960</span><span class="kw"> </span><span class="dv">2240</span><span class="kw">  </span><span class="dv">1050</span><span class="kw"> </span><span class="dv">1053</span><span class="kw"> </span><span class="dv">1059</span><span class="kw"> </span><span class="dv">1089</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPMS&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Monitor&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Monitor3&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;QNIX&quot;</span>
    ModelName<span class="kw">      </span><span class="dt">&quot;QX2710&quot;</span>
    DisplaySize<span class="kw">     </span><span class="dv">597</span><span class="kw">    </span><span class="dv">336</span>
    HorizSync<span class="kw">       </span><span class="fl">88.8</span><span class="kw"> - </span><span class="fl">160.0</span>
    VertRefresh<span class="kw">     </span><span class="fl">59.5</span><span class="kw"> - </span><span class="fl">120.0</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440&quot;</span><span class="kw">          </span><span class="fl">241.50</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2608</span><span class="kw"> </span><span class="dv">2640</span><span class="kw"> </span><span class="dv">2720</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1481</span><span class="kw"> +</span><span class="ot">hsync</span><span class="kw"> -</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_60&quot;</span><span class="kw">       </span><span class="fl">312.25</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2752</span><span class="kw"> </span><span class="dv">3024</span><span class="kw"> </span><span class="dv">3488</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1493</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_75&quot;</span><span class="kw">       </span><span class="fl">397.25</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2760</span><span class="kw"> </span><span class="dv">3040</span><span class="kw"> </span><span class="dv">3520</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1506</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_85&quot;</span><span class="kw">       </span><span class="fl">454.75</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2768</span><span class="kw"> </span><span class="dv">3048</span><span class="kw"> </span><span class="dv">3536</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1514</span><span class="kw"> -</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    ModeLine<span class="kw">       </span><span class="dt">&quot;2560x1440_96&quot;</span><span class="kw">       </span><span class="fl">400.00</span><span class="kw"> </span><span class="dv">2560</span><span class="kw"> </span><span class="dv">2608</span><span class="kw"> </span><span class="dv">2640</span><span class="kw"> </span><span class="dv">2744</span><span class="kw"> </span><span class="dv">1440</span><span class="kw"> </span><span class="dv">1443</span><span class="kw"> </span><span class="dv">1448</span><span class="kw"> </span><span class="dv">1512</span><span class="kw"> +</span><span class="ot">hsync</span><span class="kw"> +</span><span class="ot">vsync</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPMS&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Device&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;DVI-port-top&quot;</span>
    Driver<span class="kw">         </span><span class="dt">&quot;nvidia&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;NVIDIA Corporation&quot;</span>
    BoardName<span class="kw">      </span><span class="dt">&quot;GeForce GTX 750 Ti&quot;</span>
    BusID<span class="kw">          </span><span class="dt">&quot;PCI:2:0:0&quot;</span>
    Screen<span class="kw">          </span><span class="dv">0</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEdidDpi&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPI&quot;</span><span class="kw"> </span><span class="dt">&quot;108 x 108&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoLogo&quot;</span><span class="kw"> </span><span class="dt">&quot;1&quot;</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Device&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;HDMI-port-right&quot;</span>
    Driver<span class="kw">         </span><span class="dt">&quot;nvidia&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;NVIDIA Corporation&quot;</span>
    BoardName<span class="kw">      </span><span class="dt">&quot;GeForce GTX 750 Ti&quot;</span>
    BusID<span class="kw">          </span><span class="dt">&quot;PCI:2:0:0&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEdidDpi&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPI&quot;</span><span class="kw"> </span><span class="dt">&quot;90 x 90&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoLogo&quot;</span><span class="kw"> </span><span class="dt">&quot;1&quot;</span>
    Screen<span class="kw">          </span><span class="dv">1</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Device&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;HDMI-port-left&quot;</span>
    Driver<span class="kw">         </span><span class="dt">&quot;nvidia&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;NVIDIA Corporation&quot;</span>
    BoardName<span class="kw">      </span><span class="dt">&quot;GeForce GTX 750 Ti&quot;</span>
    BusID<span class="kw">          </span><span class="dt">&quot;PCI:2:0:0&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEdidDpi&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPI&quot;</span><span class="kw"> </span><span class="dt">&quot;90 x 90&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoLogo&quot;</span><span class="kw"> </span><span class="dt">&quot;1&quot;</span>
    Screen<span class="kw">          </span><span class="dv">2</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Device&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;DVI-port-bottom&quot;</span>
    Driver<span class="kw">         </span><span class="dt">&quot;nvidia&quot;</span>
    VendorName<span class="kw">     </span><span class="dt">&quot;NVIDIA Corporation&quot;</span>
    BoardName<span class="kw">      </span><span class="dt">&quot;GeForce GTX 750 Ti&quot;</span>
    BusID<span class="kw">          </span><span class="dt">&quot;PCI:2:0:0&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEdidDpi&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;DPI&quot;</span><span class="kw"> </span><span class="dt">&quot;108 x 108&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoLogo&quot;</span><span class="kw"> </span><span class="dt">&quot;1&quot;</span>
    Screen<span class="kw">          </span><span class="dv">3</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Screen&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Qnix1&quot;</span>
    Device<span class="kw">         </span><span class="dt">&quot;DVI-port-top&quot;</span>
    Monitor<span class="kw">        </span><span class="dt">&quot;Monitor0&quot;</span>
    DefaultDepth<span class="kw">    </span><span class="dv">24</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDID&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDDPI&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDFreqs&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ExactModeTimingsDVI&quot;</span><span class="kw"> </span><span class="dt">&quot;True&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ModeValidation&quot;</span><span class="kw"> </span><span class="dt">&quot;AllowNonEdidModes, NoVertRefreshCheck, NoHorizSyncCheck, NoMaxSizeCheck, NoMaxPClkCheck, NoEDIDModes&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoBandWidthTest&quot;</span><span class="kw"> </span><span class="dt">&quot;true&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;metamodes&quot;</span><span class="kw"> </span><span class="dt">&quot;DVI-I-1: 2560x1440_96 +0+0 {rotation=left}&quot;</span>
    <span class="fu">SubSection</span>     <span class="st">&quot;Display&quot;</span>
        Depth<span class="kw">       </span><span class="dv">24</span>
    <span class="fu">EndSubSection</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Screen&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Acer1&quot;</span>
    Device<span class="kw">         </span><span class="dt">&quot;HDMI-port-right&quot;</span>
    Monitor<span class="kw">        </span><span class="dt">&quot;Monitor1&quot;</span>
    DefaultDepth<span class="kw">    </span><span class="dv">24</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDID&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDDPI&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDFreqs&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ExactModeTimingsDVI&quot;</span><span class="kw"> </span><span class="dt">&quot;True&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ModeValidation&quot;</span><span class="kw"> </span><span class="dt">&quot;AllowNonEdidModes, NoVertRefreshCheck, NoHorizSyncCheck, NoMaxSizeCheck, NoMaxPClkCheck, NoEDIDModes&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoBandWidthTest&quot;</span><span class="kw"> </span><span class="dt">&quot;true&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;metamodes&quot;</span><span class="kw"> </span><span class="dt">&quot;HDMI-0: 1680x1050_60.00 +0+0 {rotation=right}&quot;</span>
    <span class="fu">SubSection</span>     <span class="st">&quot;Display&quot;</span>
        Depth<span class="kw">       </span><span class="dv">24</span>
    <span class="fu">EndSubSection</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Screen&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Acer2&quot;</span>
    Device<span class="kw">         </span><span class="dt">&quot;HDMI-port-left&quot;</span>
    Monitor<span class="kw">        </span><span class="dt">&quot;Monitor2&quot;</span>
    DefaultDepth<span class="kw">    </span><span class="dv">24</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDID&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDDPI&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDFreqs&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ExactModeTimingsDVI&quot;</span><span class="kw"> </span><span class="dt">&quot;True&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ModeValidation&quot;</span><span class="kw"> </span><span class="dt">&quot;AllowNonEdidModes, NoVertRefreshCheck, NoHorizSyncCheck, NoMaxSizeCheck, NoMaxPClkCheck, NoEDIDModes&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoBandWidthTest&quot;</span><span class="kw"> </span><span class="dt">&quot;true&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;metamodes&quot;</span><span class="kw"> </span><span class="dt">&quot;HDMI-1: 1680x1050_60.00 +0+0 {rotation=left}&quot;</span>
    <span class="fu">SubSection</span>     <span class="st">&quot;Display&quot;</span>
        Depth<span class="kw">       </span><span class="dv">24</span>
    <span class="fu">EndSubSection</span>
<span class="fu">EndSection</span>

<span class="fu">Section</span> <span class="st">&quot;Screen&quot;</span>
    Identifier<span class="kw">     </span><span class="dt">&quot;Qnix2&quot;</span>
    Device<span class="kw">         </span><span class="dt">&quot;DVI-port-bottom&quot;</span>
    Monitor<span class="kw">        </span><span class="dt">&quot;Monitor3&quot;</span>
    DefaultDepth<span class="kw">    </span><span class="dv">24</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDID&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDDPI&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;UseEDIDFreqs&quot;</span><span class="kw"> </span><span class="dt">&quot;False&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ExactModeTimingsDVI&quot;</span><span class="kw"> </span><span class="dt">&quot;True&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;ModeValidation&quot;</span><span class="kw"> </span><span class="dt">&quot;AllowNonEdidModes, NoVertRefreshCheck, NoHorizSyncCheck, NoMaxSizeCheck, NoMaxPClkCheck, NoEDIDModes&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;NoBandWidthTest&quot;</span><span class="kw"> </span><span class="dt">&quot;true&quot;</span>
    Option<span class="kw">         </span><span class="dt">&quot;metamodes&quot;</span><span class="kw"> </span><span class="dt">&quot;DVI-D-0: 2560x1440_96 +0+0 {rotation=left}&quot;</span>
    <span class="fu">SubSection</span>     <span class="st">&quot;Display&quot;</span>
        Depth<span class="kw">       </span><span class="dv">24</span>
    <span class="fu">EndSubSection</span>
<span class="fu">EndSection</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/quad-monitor-portrait.xorg.conf"  mimetype=text/plain > quad-monitor-portrait.xorg.conf </a>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I tried using the higher refresh rate modelines, but they resulted in my monitors going crazy (extreme artifacting, lines shrieking irregularly with different colors, etc.).<a href="#fnref1">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>Linus's Haskell Coding Style (LHCS)</title>
    <link href="http://listx.github.io/post/2014-05-02-linus-haskell-coding-style.html" />
    <id>http://listx.github.io/post/2014-05-02-linus-haskell-coding-style.html</id>
    <published>2014-05-02T00:00:00Z</published>
    <updated>2014-05-02T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-05-02</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-05-02-linus-haskell-coding-style.md" title="History">*</a>
	<br>
	<a href="/tag/haskell.html">haskell</a>, <a href="/tag/programming.html">programming</a>
</div>

<p>Haskell is my favorite programming language. However, unlike mainstream languages (C, Java, Ruby, etc.), there are no known “coding styles” for it. C has the venerable Linux Kernel Coding Style <a href="https://www.kernel.org/doc/Documentation/CodingStyle">LKCS</a>, among many others. I really like LKCS because it is designed to be as readable as possible, and is actually pretty simple (no fancy indentation/brace rules). I just wish there was something like LKCS for Haskell, mainly because every time I open up Haskell code somebody else wrote, it is plagued with gargantuan amounts of indentation. It really has gotten out of hand. So, I hereby propose some rules to reduce the level of indentation, whether you use tabs or spaces.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>NOTE: I use 4-character-wide tabs for Haskell; your browser may not render this correctly, but bear with me.</p>
<h2 id="chapter-1-indentation">Chapter 1: Indentation</h2>
<h3 id="wherever-possible-use-minimal-hanging-indentation">Wherever possible, use minimal hanging indentation</h3>
<p>That is, indent as little as possible.</p>
<h4 id="where-clause"><code>where</code> clause</h4>
<p>Whenever you use a <code>where</code> clause, use it like this:</p>
<pre><code>...
f x y
	where
	f = ...
	x = ...
	y = ...
	...</code></pre>
<p>That is, put <code>where</code> on its own line, and then avoid any additional indentation for all definitions that follow.</p>
<h4 id="guards">Guards</h4>
<p>Use guards like this:</p>
<pre><code>someArbitraryFunctionName x y z
	| x == 0 = ...
	| y == 0 = ...
	| z == 0 = ...
	| otherwise = ...</code></pre>
<p>not like this:</p>
<pre><code>someArbitraryFunctionName x y z | x == 0 = ...
                                | y == 0 = ...
                                | z == 0 = ...
                                | otherwise = ...</code></pre>
<p>I.e., put guards on their own line with a single indent.</p>
<h4 id="case-expressions"><code>case</code> expressions</h4>
<p>Do not vertically-align the different cases.</p>
<p>Do</p>
<pre><code>foo x = case x of
	Abcdef y -&gt; ...
	Foo y -&gt; ...
	Abracadabra y -&gt; ...</code></pre>
<p>instead of</p>
<pre><code>foo x = case x of
	Abcdef y      -&gt; ...
	Foo y         -&gt; ...
	Abracadabra y -&gt; ...</code></pre>
<p>. The only time you should vertically align <em>anything</em> is for lists, or perhaps long tuples.</p>
<h4 id="lists">Lists</h4>
<p>Align lists as follows:</p>
<pre><code>someLongList =
	[ abcd
	, efghi
	, jkl
	, m
	, nopqrstu
	, vwxyz
	]</code></pre>
<p>. You may align long tuples in a similar manner.</p>
<h4 id="do-notation"><code>do</code> notation</h4>
<p>Use ``hanging’’ do-notation:</p>
<pre><code>main = do
	x &lt;- foo
	y z</code></pre>
<p>instead of</p>
<pre><code>main = do x &lt;- foo
          y z</code></pre>
<p>(which tries to align the <code>x</code> and <code>y</code> together)</p>
<p>or</p>
<pre><code>main = do
          x &lt;- foo
          y z</code></pre>
<p>. When writing <code>let</code> statements inside <code>do</code> notation, write the keyword <code>let</code> on its own line, and indent any subsequent <code>let</code>-bindings.</p>
<h2 id="chapter-2-misc-guidelines">Chapter 2: Misc Guidelines</h2>
<h3 id="always-use-explicit-type-signatures">Always use explicit type signatures</h3>
<p>Everyone reading your code will appreciate it. Don’t force me to load up your code in GHCi to figure out how to use it with (:t) — <strong>stop wasting everyone’s time</strong>.</p>
<h3 id="refrain-from-infix-notation">Refrain from infix notation</h3>
<p>Sometimes infix notation makes code shorter, but it gets confusing when you use the same function with and without it. Also, in many cases prefix notation is simply shorter because you don’t have to use the two backtick characters around the function name. Use infix notation as often as you’d use GOTO in C.</p>
<h3 id="prefer-where-over-let">Prefer <code>where</code> over <code>let</code></h3>
<p>This is because if you use <code>where</code> clauses, the high-level code comes first, followed by <code>where</code> and the various smaller components that make up the preceding code. Macro-to-micro reading/understanding is almost always superior. Using <code>where</code> clauses also has the benefit of allowing you to more easily move out helper functions defined as part of a <code>where</code> block into their own standalone functions if they grow too big. If you use <code>let</code> expressions, you run the risk of including variables in the parent function block’s scope, which makes “detaching” them harder later on.</p>
<h3 id="do-not-use-multiline-----comment-blocks">Do not use multiline {- -} comment blocks</h3>
<p>Haddock prefers single-line comments, anyway.</p>
<h3 id="use-two-groups-of-imports-system-wide-and-package-wide-and-have-each-group-alphabetically-ordered">Use two groups of imports: system-wide and package-wide (and have each group alphabetically ordered)</h3>
<p>Import all external library modules in their own ``paragraph’’, followed by those modules of your own library; e.g., do</p>
<pre><code>import Control.Monad
import Data.Maybe
import Data.Text

import MyModule.One
import MyModule.Two</code></pre>
<p>.</p>
<h3 id="place-one-pragma-per-line-in-alphabetical-order">Place one pragma per line, in alphabetical order</h3>
<p>Do it like this:</p>
<pre><code>{-# LANGUAGE SomeBadExtension #-}
{-# LANGUAGE SomeCoolExtension #-}
{-# LANGUAGE SomeScaryExtension #-}
{-# LANGUAGE SomeUglyExtension #-}
{-# LANGUAGE StrangeExtensionNobodyUnderstands #-}</code></pre>
<h3 id="try-to-use-as-few-pragmas-as-possible">Try to use as few pragmas as possible</h3>
<p>Do not use 20 language extensions when you don’t have to. Saving a handful of keystrokes is not a good reason to use a multitude of extensions.</p>
<h3 id="when-writing-documentation-prefer-high-level-documentation-over-line-by-line-documentation">When writing documentation, prefer high-level documentation over line-by-line documentation</h3>
<p>If you have a 20-line function, write how it works with a high-level overview. Haskell is a pure language so it’s very easy to tell how the small pieces work. So, explain the bigger pieces, and <em>why</em> they are necessary as written.</p>
<h3 id="breaking-long-lines-and-strings">Breaking long lines and strings</h3>
<p>We follow LKCS’s 80-character column limit.</p>
<p>If you must, break long lines into sensible chunks. If a function has numerous arguments, you may put each argument on its own line. If you want to break up a long chain of functions, break them up like this:</p>
<pre><code>foo x y z = head
	. init
	. blahblah y
	. funcMX x
	$ abcd z</code></pre>
<p>, with each function on its own line, with the function composition operator <code>.</code> as the leading character, similar to how the comma <code>,</code> is the leading character for breaking up long lists.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I prefer tabs for indentation, and spaces for alignment (which does happen once in a blue moon).<a href="#fnref1">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>
<entry>
    <title>OpenGL from Haskell (#3: Matrices)</title>
    <link href="http://listx.github.io/post/2014-03-19-opengl-haskell-3-matrices.html" />
    <id>http://listx.github.io/post/2014-03-19-opengl-haskell-3-matrices.html</id>
    <published>2014-03-19T00:00:00Z</published>
    <updated>2014-03-19T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-03-19</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-03-19-opengl-haskell-3-matrices.md" title="History">*</a>
	<br>
	<a href="/tag/haskell.html">haskell</a>, <a href="/tag/opengl.html">opengl</a>
</div>

<p>The following is my translation/adaptation of <a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/">tutorial #2</a> at <a href="http://www.opengl-tutorial.org" class="uri">http://www.opengl-tutorial.org</a>. My <a href="2014-03-15-opengl-from-haskell.html">last post</a> was a translation of tutorial #2, which dealt with triangles — this is the reason why this post’s title is called “#3: Matrices”. The end result of this tutorial is a 3D triangle with 3 different colored vertices that are interpolated smoothly by OpenGL.</p>
<p>My version again uses the code from <a href="https://github.com/YPares/Haskell-OpenGL3.1-Tutos" class="uri">https://github.com/YPares/Haskell-OpenGL3.1-Tutos</a>. The <code>Data.Vec</code> import is for the <a href="http://hackage.haskell.org/package/Vec">Vec</a> package. Like my last post, my code here does does not use <code>Control.Applicative</code> puts everything, including the GLSL shaders directly into the code. The <code>RankNTypes</code> and <code>TypeOperators</code> GHC extensions are only there to suppress warnings from using <code>ghc --make -Wall</code>; if you don’t want to use these extensions, just remove the type signature for the <code>vec3</code> function near the bottom.</p>
<p>I have also removed the use of backticks for Haskell’s infix notation (<code>`...`</code>). It’s not because I like using parentheses — I just don’t like using infix notation because it runs against the argument handling order of normal functions found everywhere else.</p>
<p>Also, I have fixed YPares’s original <code>lookAt</code> function which is actually <a href="https://github.com/YPares/Haskell-OpenGL3.1-Tutos/commit/7a027b927d061fbd26138cb7357c40c4cacbc927">broken as of commit 7a027b927d061fbd26138cb7357c40c4cacbc927</a>; you will need my version if you wish to pursue the later tutorials that actually test the validity of this function, such as the keyboard/mouse input tutorial #6 from <a href="http://www.opengl-tutorial.org" class="uri">http://www.opengl-tutorial.org</a>.</p>
<p>The code here is released into the Public Domain.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/opengl/matrices.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE PackageImports #-}</span>
<span class="ot">{-# LANGUAGE RecordWildCards #-}</span>
<span class="ot">{-# LANGUAGE RankNTypes #-}</span>
<span class="ot">{-# LANGUAGE TypeOperators #-}</span>
<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Monad</span>
<span class="kw">import </span><span class="dt">Data.Maybe</span>
<span class="kw">import </span><span class="dt">Data.Vec</span>
<span class="kw">import </span><span class="dt">Foreign</span>
<span class="kw">import </span><span class="dt">Foreign.C.String</span>
<span class="kw">import </span><span class="dt">Foreign.C.Types</span>
<span class="kw">import qualified</span> &quot;<span class="dt">GLFW</span>-b&quot; <span class="dt">Graphics.UI.GLFW</span> <span class="kw">as</span> <span class="dt">GLFW</span>
<span class="kw">import </span><span class="dt">Graphics.Rendering.OpenGL.Raw</span>
<span class="kw">import </span><span class="dt">System.Exit</span>

<span class="kw">data</span> <span class="dt">GLIDs</span> <span class="fu">=</span> <span class="dt">GLIDs</span>
	{<span class="ot"> progId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> vertexArrayId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> vertexAttrib ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> vertexBufferId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> colorAttrib ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> colorBufferId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> mvpMatrixUniform ::</span> <span class="fu">!</span><span class="dt">GLint</span>
	}

<span class="ot">withNewPtr ::</span> <span class="dt">Storable</span> b <span class="ot">=&gt;</span> (<span class="dt">Ptr</span> b <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> b
withNewPtr f <span class="fu">=</span> alloca (\p <span class="ot">-&gt;</span> f p <span class="fu">&gt;&gt;</span> peek p)

<span class="ot">initialize ::</span> <span class="dt">IO</span> <span class="dt">GLFW.Window</span>
initialize <span class="fu">=</span> <span class="kw">do</span>
	ok <span class="ot">&lt;-</span> GLFW.init
	when (not ok) <span class="fu">$</span> <span class="kw">do</span>
		_ <span class="ot">&lt;-</span> fail <span class="st">&quot;Failed to initialize GLFW&quot;</span>
		exitFailure
	mapM_ GLFW.windowHint
		[ <span class="dt">GLFW.WindowHint&#39;Samples</span> <span class="dv">4</span> <span class="co">-- 4x antialiasing</span>
		, <span class="dt">GLFW.WindowHint&#39;ContextVersionMajor</span> <span class="dv">3</span> <span class="co">-- OpenGL 3.3</span>
		, <span class="dt">GLFW.WindowHint&#39;ContextVersionMinor</span> <span class="dv">3</span>
		, <span class="dt">GLFW.WindowHint&#39;OpenGLProfile</span> <span class="dt">GLFW.OpenGLProfile&#39;Core</span>
		]

	win <span class="ot">&lt;-</span> GLFW.createWindow <span class="dv">800</span> <span class="dv">600</span> <span class="st">&quot;Window Title&quot;</span> <span class="dt">Nothing</span> <span class="dt">Nothing</span>
	when (isNothing win) <span class="fu">$</span> <span class="kw">do</span>
		_ <span class="ot">&lt;-</span> fail <span class="st">&quot;Failed to create OpenGL window&quot;</span>
		GLFW.terminate
		exitFailure
	<span class="kw">let</span>
		win&#39; <span class="fu">=</span> fromJust win
	GLFW.makeContextCurrent win
	GLFW.setStickyKeysInputMode win&#39; <span class="dt">GLFW.StickyKeysInputMode&#39;Enabled</span>
	return win&#39;

<span class="ot">initializeGL ::</span> <span class="dt">IO</span> <span class="dt">GLIDs</span>
initializeGL <span class="fu">=</span> <span class="kw">do</span>
	glClearColor <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.4</span> <span class="dv">0</span>
	progId <span class="ot">&lt;-</span> loadProgram
		(<span class="st">&quot;vertexShader2&quot;</span>, vertexShader2)
		(<span class="st">&quot;fragmentShader2&quot;</span>, fragmentShader2)
	v <span class="ot">&lt;-</span> withCString <span class="st">&quot;vertexPosition_modelspace&quot;</span>
		<span class="fu">$</span> glGetAttribLocation progId
	c <span class="ot">&lt;-</span> withCString <span class="st">&quot;vertexColor&quot;</span> <span class="fu">$</span> glGetAttribLocation progId
	m <span class="ot">&lt;-</span> withCString <span class="st">&quot;MVP&quot;</span> <span class="fu">$</span> glGetUniformLocation progId
	vertexAttrib <span class="ot">&lt;-</span> findAttribUniform v <span class="st">&quot;vertexPosition_modelspace&quot;</span>
	colorAttrib <span class="ot">&lt;-</span> findAttribUniform c <span class="st">&quot;vertexColor&quot;</span>
	mvpMatrixUniform <span class="ot">&lt;-</span> findAttribUniform m <span class="st">&quot;MVP&quot;</span>
	vertexArrayId <span class="ot">&lt;-</span> newVAO
	vertexBufferId <span class="ot">&lt;-</span> fillNewBuffer vertexBufferData
	colorBufferId <span class="ot">&lt;-</span> fillNewBuffer colorBufferData
	return <span class="dt">GLIDs</span>{<span class="fu">..</span>}
	<span class="kw">where</span>
<span class="ot">	vertexBufferData ::</span> [<span class="dt">GLfloat</span>]
	vertexBufferData <span class="fu">=</span>
		<span class="co">-- x, y, z</span>
		[ <span class="fu">-</span><span class="dv">1</span>, <span class="fu">-</span><span class="dv">1</span>, <span class="dv">0</span>
		,  <span class="dv">1</span>, <span class="fu">-</span><span class="dv">1</span>, <span class="dv">0</span>
		,  <span class="dv">0</span>,  <span class="dv">1</span>, <span class="dv">0</span>
		]
<span class="ot">	colorBufferData ::</span> [<span class="dt">GLfloat</span>]
	colorBufferData <span class="fu">=</span>
		[ <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>
		, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>
		, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>
		]
	findAttribUniform x name <span class="fu">=</span> <span class="kw">if</span> x <span class="fu">&lt;</span> <span class="dv">0</span>
		<span class="kw">then</span> error <span class="fu">$</span> <span class="st">&quot;`&quot;</span> <span class="fu">++</span> name <span class="fu">++</span> <span class="st">&quot;&#39; cannot be found!&quot;</span>
		<span class="kw">else</span> return <span class="fu">$</span> fromIntegral x

<span class="ot">freeResources ::</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
freeResources <span class="dt">GLIDs</span>{<span class="fu">..</span>} <span class="fu">=</span> <span class="kw">do</span>
	with vertexBufferId <span class="fu">$</span> glDeleteBuffers <span class="dv">1</span>
	with colorBufferId <span class="fu">$</span> glDeleteBuffers <span class="dv">1</span>
	with vertexArrayId <span class="fu">$</span> glDeleteVertexArrays <span class="dv">1</span>

<span class="ot">newVAO ::</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
newVAO <span class="fu">=</span> <span class="kw">do</span>
	vaId <span class="ot">&lt;-</span> withNewPtr (glGenVertexArrays <span class="dv">1</span>)
	glBindVertexArray vaId
	return vaId

<span class="ot">fillNewBuffer ::</span> [<span class="dt">GLfloat</span>] <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
fillNewBuffer xs <span class="fu">=</span> <span class="kw">do</span>
	bufId <span class="ot">&lt;-</span> withNewPtr (glGenBuffers <span class="dv">1</span>)
	glBindBuffer gl_ARRAY_BUFFER bufId
	withArrayLen xs func <span class="co">-- give given vertices to OpenGL</span>
	return bufId
	<span class="kw">where</span>
	func len ptr <span class="fu">=</span> glBufferData
		gl_ARRAY_BUFFER
		(fromIntegral (len <span class="fu">*</span> sizeOf (undefined<span class="ot"> ::</span> <span class="dt">GLfloat</span>)))
		(<span class="ot">ptr ::</span> <span class="dt">Ptr</span> <span class="dt">GLfloat</span>)
		gl_STATIC_DRAW

<span class="ot">bindBufferToAttrib ::</span> <span class="dt">GLuint</span> <span class="ot">-&gt;</span> <span class="dt">GLuint</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
bindBufferToAttrib bufId attribLoc <span class="fu">=</span> <span class="kw">do</span>
	glEnableVertexAttribArray attribLoc
	glBindBuffer gl_ARRAY_BUFFER bufId
	glVertexAttribPointer
		attribLoc <span class="co">-- attribute location in the shader</span>
		<span class="dv">3</span> <span class="co">-- 3 components per vertex</span>
		gl_FLOAT <span class="co">-- coord type</span>
		(fromBool <span class="dt">False</span>) <span class="co">-- normalize?</span>
		<span class="dv">0</span> <span class="co">-- stride</span>
		nullPtr <span class="co">-- vertex buffer offset</span>

<span class="ot">loadProgram ::</span> (<span class="dt">String</span>, <span class="dt">String</span>) <span class="ot">-&gt;</span> (<span class="dt">String</span>, <span class="dt">String</span>) <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
loadProgram vertShader fragShader <span class="fu">=</span> <span class="kw">do</span>
	shaderIds <span class="ot">&lt;-</span> mapM (uncurry loadShader)
		[ (gl_VERTEX_SHADER, vertShader)
		, (gl_FRAGMENT_SHADER, fragShader)
		]
	progId <span class="ot">&lt;-</span> glCreateProgram
	putStrLn <span class="st">&quot;Linking program&quot;</span>
	mapM_ (glAttachShader progId) shaderIds
	glLinkProgram progId
	_ <span class="ot">&lt;-</span> checkStatus
		gl_LINK_STATUS glGetProgramiv glGetProgramInfoLog progId
	mapM_ glDeleteShader shaderIds
	return progId

<span class="ot">loadShader ::</span> <span class="dt">GLenum</span> <span class="ot">-&gt;</span> (<span class="dt">String</span>, <span class="dt">String</span>) <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
loadShader shaderTypeFlag (name, code) <span class="fu">=</span> <span class="kw">do</span>
	shaderId <span class="ot">&lt;-</span> glCreateShader shaderTypeFlag
	withCString code <span class="fu">$</span> \codePtr <span class="ot">-&gt;</span>
		with codePtr <span class="fu">$</span> \codePtrPtr <span class="ot">-&gt;</span>
			glShaderSource shaderId <span class="dv">1</span> codePtrPtr nullPtr
	putStrLn <span class="fu">$</span> <span class="st">&quot;Compiling shader `&quot;</span> <span class="fu">++</span> name <span class="fu">++</span> <span class="st">&quot;&#39;&quot;</span>
	glCompileShader shaderId
	_ <span class="ot">&lt;-</span> checkStatus
		gl_COMPILE_STATUS glGetShaderiv glGetShaderInfoLog shaderId
	return shaderId

<span class="ot">checkStatus ::</span> (<span class="dt">Integral</span> a1, <span class="dt">Storable</span> a1)
	<span class="ot">=&gt;</span> <span class="dt">GLenum</span>
	<span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> <span class="dt">GLenum</span> <span class="ot">-&gt;</span> <span class="dt">Ptr</span> a1 <span class="ot">-&gt;</span> <span class="dt">IO</span> a)
	<span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> a1 <span class="ot">-&gt;</span> <span class="dt">Ptr</span> a3 <span class="ot">-&gt;</span> <span class="dt">Ptr</span> <span class="dt">Foreign.C.Types.CChar</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a2)
	<span class="ot">-&gt;</span> t
	<span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Bool</span>
checkStatus statusFlag glGetFn glInfoLogFn componentId <span class="fu">=</span> <span class="kw">do</span>
	<span class="kw">let</span>
		fetch info <span class="fu">=</span> withNewPtr (glGetFn componentId info)
	status <span class="ot">&lt;-</span> liftM toBool <span class="fu">$</span> fetch statusFlag
	logLength <span class="ot">&lt;-</span> fetch gl_INFO_LOG_LENGTH
	when (logLength <span class="fu">&gt;</span> <span class="dv">0</span>) <span class="fu">$</span>
		allocaArray0 (fromIntegral logLength) <span class="fu">$</span> \msgPtr <span class="ot">-&gt;</span> <span class="kw">do</span>
			_ <span class="ot">&lt;-</span> glInfoLogFn componentId logLength nullPtr msgPtr
			msg <span class="ot">&lt;-</span> peekCString msgPtr
			(<span class="kw">if</span> status <span class="kw">then</span> putStrLn <span class="kw">else</span> fail) msg
	return status

<span class="ot">fragmentShader2 ::</span> <span class="dt">String</span>
fragmentShader2 <span class="fu">=</span> unlines
	[ <span class="st">&quot;#version 330 core&quot;</span>
	, <span class="st">&quot;in vec3 fragmentColor;&quot;</span>
	, <span class="st">&quot;out vec3 finalColor;&quot;</span>
	, <span class="st">&quot;void main()&quot;</span>
	, <span class="st">&quot;{&quot;</span>
		, <span class="st">&quot;finalColor= fragmentColor;&quot;</span>
	, <span class="st">&quot;}&quot;</span>
	]

<span class="ot">vertexShader2 ::</span> <span class="dt">String</span>
vertexShader2 <span class="fu">=</span> unlines
	[ <span class="st">&quot;#version 330 core&quot;</span>
	<span class="co">-- Input vertex data, different for all executions of this shader.</span>
	, <span class="st">&quot;in vec3 vertexPosition_modelspace;&quot;</span>
	, <span class="st">&quot;in vec3 vertexColor;&quot;</span>
	<span class="co">-- Values that stay constant for the whole mesh</span>
	, <span class="st">&quot;uniform mat4 MVP;&quot;</span>
	, <span class="st">&quot;out vec3 fragmentColor;&quot;</span>
	, <span class="st">&quot;void main()&quot;</span>
	, <span class="st">&quot;{&quot;</span>
		, <span class="st">&quot;fragmentColor = vertexColor;&quot;</span>
		, <span class="st">&quot;vec4 v = vec4(vertexPosition_modelspace, 1);&quot;</span>
		, <span class="st">&quot;gl_Position = MVP * v;&quot;</span>
	, <span class="st">&quot;}&quot;</span>
	]

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
	win <span class="ot">&lt;-</span> initialize
	glids <span class="ot">&lt;-</span> initializeGL
	inputLoop win glids
	freeResources glids
	GLFW.terminate
	return ()

<span class="ot">inputLoop ::</span> <span class="dt">GLFW.Window</span> <span class="ot">-&gt;</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
inputLoop win glids <span class="fu">=</span> <span class="kw">do</span>
	drawStuff glids
	GLFW.swapBuffers win
	GLFW.pollEvents
	keyState <span class="ot">&lt;-</span> GLFW.getKey win <span class="dt">GLFW.Key&#39;Escape</span>
	closeWindow <span class="ot">&lt;-</span> GLFW.windowShouldClose win
	when (keyState <span class="fu">/=</span> <span class="dt">GLFW.KeyState&#39;Pressed</span> <span class="fu">&amp;&amp;</span> closeWindow <span class="fu">==</span> <span class="dt">False</span>) <span class="fu">$</span>
		inputLoop win glids

<span class="ot">drawStuff ::</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
drawStuff <span class="dt">GLIDs</span>{<span class="fu">..</span>} <span class="fu">=</span> <span class="kw">do</span>
	glClear gl_COLOR_BUFFER_BIT
	glClear gl_DEPTH_BUFFER_BIT
	glUseProgram progId
	<span class="co">-- the (fromBool True) is because we are ROW-first (Data.Vec)</span>
	with mvpMatrix
		<span class="fu">$</span> glUniformMatrix4fv mvpMatrixUniform <span class="dv">1</span> (fromBool <span class="dt">True</span>)
		<span class="fu">.</span> castPtr
	bindBufferToAttrib vertexBufferId vertexAttrib
	bindBufferToAttrib colorBufferId colorAttrib
	glDrawArrays gl_TRIANGLES <span class="dv">0</span> <span class="dv">3</span>
	glDisableVertexAttribArray colorAttrib
	glDisableVertexAttribArray vertexAttrib

<span class="co">-- Some higher-order math helper functions. Depending on what math</span>
<span class="co">-- library you use, you&#39;d use the functions that comes with that</span>
<span class="co">-- library. The functions here are from the Data.Vec package.</span>
<span class="ot">vec3 ::</span> forall a a1 a2<span class="fu">.</span> a <span class="ot">-&gt;</span> a1 <span class="ot">-&gt;</span> a2 <span class="ot">-&gt;</span> a <span class="fu">:.</span> (a1 <span class="fu">:.</span> (a2 <span class="fu">:.</span> ()))
vec3 x y z <span class="fu">=</span> x <span class="fu">:.</span> y <span class="fu">:.</span> z<span class="fu">:.</span> ()

<span class="ot">mvpMatrix ::</span> <span class="dt">Mat44</span> <span class="dt">GLfloat</span>
mvpMatrix <span class="fu">=</span> multmm (multmm projection view) model
	<span class="kw">where</span>
	projection <span class="fu">=</span> perspective <span class="fl">0.1</span> <span class="dv">100</span> (pi<span class="fu">/</span><span class="dv">4</span>) (<span class="dv">4</span><span class="fu">/</span><span class="dv">3</span>)
	view <span class="fu">=</span> lookAt (vec3 <span class="dv">4</span> <span class="dv">3</span> <span class="dv">3</span>) (vec3 <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span>) (vec3 <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span>)
	model <span class="fu">=</span> identity

<span class="co">-- The closest relative to this function is Data.Vec&#39;s `rotationLookAt`. We just</span>
<span class="co">-- mirror the code found in the GLM library (glm.g-truc.net). An additional</span>
<span class="co">-- resource is Jeremiah van Oosten&#39;s &quot;Understanding the View Matrix&quot;, found at</span>
<span class="co">-- http://3dgep.com/?p=1700.</span>
<span class="ot">lookAt ::</span> <span class="dt">Floating</span> a <span class="ot">=&gt;</span> <span class="dt">Vec3</span> a <span class="ot">-&gt;</span> <span class="dt">Vec3</span> a <span class="ot">-&gt;</span> <span class="dt">Vec3</span> a <span class="ot">-&gt;</span> <span class="dt">Mat44</span> a
lookAt eye target up <span class="fu">=</span> x <span class="fu">:.</span> y <span class="fu">:.</span> z <span class="fu">:.</span> h <span class="fu">:.</span> ()
	<span class="kw">where</span>
	forward <span class="fu">=</span> normalize <span class="fu">$</span> target <span class="fu">-</span> eye
	right <span class="fu">=</span> normalize <span class="fu">$</span> cross forward up
	up&#39; <span class="fu">=</span> cross right forward
	x <span class="fu">=</span> snoc right (<span class="fu">-</span>(dot right eye))
	y <span class="fu">=</span> snoc up&#39; (<span class="fu">-</span>(dot up&#39; eye))
	z <span class="fu">=</span> snoc (<span class="fu">-</span>forward) (dot forward eye)
	h <span class="fu">=</span> <span class="dv">0</span> <span class="fu">:.</span> <span class="dv">0</span> <span class="fu">:.</span> <span class="dv">0</span> <span class="fu">:.</span> <span class="dv">1</span> <span class="fu">:.</span> ()</code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/opengl/matrices.hs"  mimetype=text/plain > matrices.hs </a>
</div>
</div>
]]></summary>
</entry>
<entry>
    <title>OpenGL from Haskell</title>
    <link href="http://listx.github.io/post/2014-03-15-opengl-from-haskell.html" />
    <id>http://listx.github.io/post/2014-03-15-opengl-from-haskell.html</id>
    <published>2014-03-15T00:00:00Z</published>
    <updated>2014-03-15T00:00:00Z</updated>
    <summary type="html"><![CDATA[<div class="info center">
	<code class="date">2014-03-15</code><a class="history" href="https://github.com/listx/listx_blog/commits/master/post/2014-03-15-opengl-from-haskell.md" title="History">*</a>
	<br>
	<a href="/tag/haskell.html">haskell</a>, <a href="/tag/opengl.html">opengl</a>
</div>

<p>The following is my translation/adaptation of <a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-2-the-first-triangle/">tutorial #2</a> at <a href="http://www.opengl-tutorial.org" class="uri">http://www.opengl-tutorial.org</a>. It draws a single red triangle on the screen with a dark blue background. It takes quite a bit of boilerplate code just to get something on the screen!</p>
<p>My version uses the code from <a href="https://github.com/YPares/Haskell-OpenGL3.1-Tutos" class="uri">https://github.com/YPares/Haskell-OpenGL3.1-Tutos</a>, but does not use <code>Control.Applicative</code> and also does not put the shaders containing GLSL in a separate text file. Everything is self-contained in one file, and it only uses the <code>PackageImports</code> and <code>RecordWildCards</code> GHC extensions. The <code>PackageImports</code> is only necessary if you have both <a href="http://hackage.haskell.org/package/GLFW">GLFW</a> and <a href="http://hackage.haskell.org/package/GLFW-b">GLFW-b</a> Hackage packages installed in your system (as they have a name clash of <code>Graphics.UI.GLFW</code>, you need to disambiguate this import by specifying the package name). The <code>RecordWildCards</code> extension is pretty standard and exists purely for syntactic sugar (no type-level hoops and such) — if you don’t know about it you should google it.</p>
<p>I went ahead and added type signatures for all top-level functions — something that many Haskell tutorial writers hate doing for some strange, unknown reason.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> Also, I ran the code through <code>ghc --make -Wall</code> and silenced all warnings.</p>
<p>I hereby release it into the Public Domain. From what I can tell, YPares’s code doesn’t have a license… I think this should be OK.</p>
<div class="code-and-raw">
<table class="sourceCode numberLines haskell" input="code/opengl/triangle.hs"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
</pre></td><td class="sourceCode"><pre><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE PackageImports #-}</span>
<span class="ot">{-# LANGUAGE RecordWildCards #-}</span>
<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Monad</span>
<span class="kw">import </span><span class="dt">Data.Maybe</span>
<span class="kw">import </span><span class="dt">Foreign</span>
<span class="kw">import </span><span class="dt">Foreign.C.String</span>
<span class="kw">import </span><span class="dt">Foreign.C.Types</span>
<span class="kw">import qualified</span> &quot;<span class="dt">GLFW</span>-b&quot; <span class="dt">Graphics.UI.GLFW</span> <span class="kw">as</span> <span class="dt">GLFW</span>
<span class="kw">import </span><span class="dt">Graphics.Rendering.OpenGL.Raw</span>
<span class="kw">import </span><span class="dt">System.Exit</span>

<span class="kw">data</span> <span class="dt">GLIDs</span> <span class="fu">=</span> <span class="dt">GLIDs</span>
	{<span class="ot"> progId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> vertexArrayId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	,<span class="ot"> vertexBufferId ::</span> <span class="fu">!</span><span class="dt">GLuint</span>
	}

<span class="ot">withNewPtr ::</span> <span class="dt">Storable</span> b <span class="ot">=&gt;</span> (<span class="dt">Ptr</span> b <span class="ot">-&gt;</span> <span class="dt">IO</span> a) <span class="ot">-&gt;</span> <span class="dt">IO</span> b
withNewPtr f <span class="fu">=</span> alloca (\p <span class="ot">-&gt;</span> f p <span class="fu">&gt;&gt;</span> peek p)

<span class="ot">initialize ::</span> <span class="dt">IO</span> <span class="dt">GLFW.Window</span>
initialize <span class="fu">=</span> <span class="kw">do</span>
	ok <span class="ot">&lt;-</span> GLFW.init
	when (not ok) <span class="fu">$</span> <span class="kw">do</span>
		_ <span class="ot">&lt;-</span> fail <span class="st">&quot;Failed to initialize GLFW&quot;</span>
		exitFailure
	mapM_ GLFW.windowHint
		[ <span class="dt">GLFW.WindowHint&#39;Samples</span> <span class="dv">4</span> <span class="co">-- 4x antialiasing</span>
		, <span class="dt">GLFW.WindowHint&#39;ContextVersionMajor</span> <span class="dv">3</span> <span class="co">-- OpenGL 3.3</span>
		, <span class="dt">GLFW.WindowHint&#39;ContextVersionMinor</span> <span class="dv">3</span>
		<span class="co">-- we don&#39;t want the old OpenGL</span>
		, <span class="dt">GLFW.WindowHint&#39;OpenGLProfile</span> <span class="dt">GLFW.OpenGLProfile&#39;Core</span>
		]

	win <span class="ot">&lt;-</span> GLFW.createWindow <span class="dv">800</span> <span class="dv">600</span> <span class="st">&quot;Window Title&quot;</span> <span class="dt">Nothing</span> <span class="dt">Nothing</span>
	when (isNothing win) <span class="fu">$</span> <span class="kw">do</span>
		_ <span class="ot">&lt;-</span> fail <span class="st">&quot;Failed to create OpenGL window&quot;</span>
		GLFW.terminate
		exitFailure
	<span class="kw">let</span>
		win&#39; <span class="fu">=</span> fromJust win
	GLFW.makeContextCurrent win

	GLFW.setStickyKeysInputMode win&#39; <span class="dt">GLFW.StickyKeysInputMode&#39;Enabled</span>

	return win&#39;

<span class="ot">initializeGL ::</span> <span class="dt">IO</span> <span class="dt">GLIDs</span>
initializeGL <span class="fu">=</span> <span class="kw">do</span>
	glClearColor <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.4</span> <span class="dv">0</span>
	progId <span class="ot">&lt;-</span> loadProgram vertexShader1 fragmentShader1
	vaId <span class="ot">&lt;-</span> newVAO
	bufId <span class="ot">&lt;-</span> fillNewBuffer vertexBufferData
	return <span class="fu">$</span> <span class="dt">GLIDs</span>
		{ progId <span class="fu">=</span> progId
		, vertexArrayId <span class="fu">=</span> vaId
		, vertexBufferId <span class="fu">=</span> bufId
		}

<span class="ot">freeResources ::</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
freeResources <span class="dt">GLIDs</span>{<span class="fu">..</span>} <span class="fu">=</span> <span class="kw">do</span>
	with vertexBufferId <span class="fu">$</span> glDeleteBuffers <span class="dv">1</span>
	with vertexArrayId <span class="fu">$</span> glDeleteVertexArrays <span class="dv">1</span>

<span class="ot">newVAO ::</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
newVAO <span class="fu">=</span> <span class="kw">do</span>
	vaId <span class="ot">&lt;-</span> withNewPtr (glGenVertexArrays <span class="dv">1</span>)
	glBindVertexArray vaId
	return vaId

<span class="ot">fillNewBuffer ::</span> [<span class="dt">GLfloat</span>] <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
fillNewBuffer xs <span class="fu">=</span> <span class="kw">do</span>
	bufId <span class="ot">&lt;-</span> withNewPtr (glGenBuffers <span class="dv">1</span>)
	glBindBuffer gl_ARRAY_BUFFER bufId
	withArrayLen xs func <span class="co">-- give given vertices to OpenGL</span>
	return bufId
	<span class="kw">where</span>
	func len ptr <span class="fu">=</span> glBufferData
		gl_ARRAY_BUFFER
		(fromIntegral (len <span class="fu">*</span> sizeOf (undefined<span class="ot"> ::</span> <span class="dt">GLfloat</span>)))
		(<span class="ot">ptr ::</span> <span class="dt">Ptr</span> <span class="dt">GLfloat</span>)
		gl_STATIC_DRAW

<span class="ot">bindBufferToAttrib ::</span> <span class="dt">GLuint</span> <span class="ot">-&gt;</span> <span class="dt">GLuint</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
bindBufferToAttrib bufId attribLoc <span class="fu">=</span> <span class="kw">do</span>
	glEnableVertexAttribArray attribLoc
	glBindBuffer gl_ARRAY_BUFFER bufId
	glVertexAttribPointer
		attribLoc <span class="co">-- attribute location in the shader</span>
		<span class="dv">3</span> <span class="co">-- 3 components per vertex</span>
		gl_FLOAT <span class="co">-- coord type</span>
		(fromBool <span class="dt">False</span>) <span class="co">-- normalize?</span>
		<span class="dv">0</span> <span class="co">-- stride</span>
		nullPtr <span class="co">-- vertex buffer offset</span>

<span class="ot">loadProgram ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
loadProgram vertShader fragShader <span class="fu">=</span> <span class="kw">do</span>
	shaderIds <span class="ot">&lt;-</span> mapM (uncurry loadShader)
		[ (gl_VERTEX_SHADER, vertShader)
		, (gl_FRAGMENT_SHADER, fragShader)
		]
	progId <span class="ot">&lt;-</span> glCreateProgram
	putStrLn <span class="st">&quot;Linking program&quot;</span>
	mapM_ (glAttachShader progId) shaderIds
	glLinkProgram progId
	_ <span class="ot">&lt;-</span> checkStatus
		gl_LINK_STATUS glGetProgramiv glGetProgramInfoLog progId
	mapM_ glDeleteShader shaderIds
	return progId

<span class="ot">loadShader ::</span> <span class="dt">GLenum</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">GLuint</span>
loadShader shaderTypeFlag code <span class="fu">=</span> <span class="kw">do</span>
	shaderId <span class="ot">&lt;-</span> glCreateShader shaderTypeFlag
	withCString code <span class="fu">$</span> \codePtr <span class="ot">-&gt;</span>
		with codePtr <span class="fu">$</span> \codePtrPtr <span class="ot">-&gt;</span>
			glShaderSource shaderId <span class="dv">1</span> codePtrPtr nullPtr
	putStrLn <span class="st">&quot;Compiling shader...&quot;</span>
	glCompileShader shaderId
	_ <span class="ot">&lt;-</span> checkStatus
		gl_COMPILE_STATUS glGetShaderiv glGetShaderInfoLog shaderId
	return shaderId

<span class="ot">checkStatus ::</span> (<span class="dt">Integral</span> a1, <span class="dt">Storable</span> a1)
	<span class="ot">=&gt;</span> <span class="dt">GLenum</span>
	<span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> <span class="dt">GLenum</span> <span class="ot">-&gt;</span> <span class="dt">Ptr</span> a1 <span class="ot">-&gt;</span> <span class="dt">IO</span> a)
	<span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> a1 <span class="ot">-&gt;</span> <span class="dt">Ptr</span> a3 <span class="ot">-&gt;</span> <span class="dt">Ptr</span> <span class="dt">Foreign.C.Types.CChar</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> a2)
	<span class="ot">-&gt;</span> t
	<span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Bool</span>
checkStatus statusFlag glGetFn glInfoLogFn componentId <span class="fu">=</span> <span class="kw">do</span>
	<span class="kw">let</span>
		fetch info <span class="fu">=</span> withNewPtr (glGetFn componentId info)
	status <span class="ot">&lt;-</span> liftM toBool <span class="fu">$</span> fetch statusFlag
	logLength <span class="ot">&lt;-</span> fetch gl_INFO_LOG_LENGTH
	when (logLength <span class="fu">&gt;</span> <span class="dv">0</span>) <span class="fu">$</span>
		allocaArray0 (fromIntegral logLength) <span class="fu">$</span> \msgPtr <span class="ot">-&gt;</span> <span class="kw">do</span>
			_ <span class="ot">&lt;-</span> glInfoLogFn componentId logLength nullPtr msgPtr
			msg <span class="ot">&lt;-</span> peekCString msgPtr
			(<span class="kw">if</span> status <span class="kw">then</span> putStrLn <span class="kw">else</span> fail) msg
	return status

<span class="ot">fragmentShader1 ::</span> <span class="dt">String</span>
fragmentShader1 <span class="fu">=</span> unlines
	[ <span class="st">&quot;#version 330 core&quot;</span>
	, <span class="st">&quot;out vec3 color;&quot;</span>
	, <span class="st">&quot;void main()&quot;</span>
	, <span class="st">&quot;{&quot;</span>
		, <span class="st">&quot;color =  vec3(1,0,0);&quot;</span> <span class="co">-- paint it red!</span>
	, <span class="st">&quot;}&quot;</span>
	]

<span class="ot">vertexShader1 ::</span> <span class="dt">String</span>
vertexShader1 <span class="fu">=</span> unlines
	[ <span class="st">&quot;#version 330 core&quot;</span>
	, <span class="st">&quot;layout(location = 0) in vec3 vPosition_modelspace;&quot;</span>
	, <span class="st">&quot;void main()&quot;</span>
	, <span class="st">&quot;{&quot;</span>
		, <span class="st">&quot;gl_Position.xyz = vPosition_modelspace;&quot;</span>
		, <span class="st">&quot;gl_Position.w = 1.0;&quot;</span>
	, <span class="st">&quot;}&quot;</span>
	]


<span class="ot">vertexBufferData ::</span> [<span class="dt">GLfloat</span>]
vertexBufferData <span class="fu">=</span>
	<span class="co">-- x, y, z</span>
	[ <span class="fu">-</span><span class="dv">1</span>, <span class="fu">-</span><span class="dv">1</span>, <span class="dv">0</span>
	,  <span class="dv">1</span>, <span class="fu">-</span><span class="dv">1</span>, <span class="dv">0</span>
	,  <span class="dv">0</span>,  <span class="dv">1</span>, <span class="dv">0</span>
	]

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
	win <span class="ot">&lt;-</span> initialize
	glids <span class="ot">&lt;-</span> initializeGL
	inputLoop win glids
	freeResources glids
	GLFW.terminate
	return ()

<span class="ot">inputLoop ::</span> <span class="dt">GLFW.Window</span> <span class="ot">-&gt;</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
inputLoop win glids <span class="fu">=</span> <span class="kw">do</span>
	drawStuff glids
	GLFW.swapBuffers win
	GLFW.pollEvents
	keyState <span class="ot">&lt;-</span> GLFW.getKey win <span class="dt">GLFW.Key&#39;Escape</span>
	closeWindow <span class="ot">&lt;-</span> GLFW.windowShouldClose win
	when (keyState <span class="fu">/=</span> <span class="dt">GLFW.KeyState&#39;Pressed</span> <span class="fu">&amp;&amp;</span> closeWindow <span class="fu">==</span> <span class="dt">False</span>) <span class="fu">$</span>
		inputLoop win glids

<span class="ot">drawStuff ::</span> <span class="dt">GLIDs</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()
drawStuff <span class="dt">GLIDs</span>{<span class="fu">..</span>} <span class="fu">=</span> <span class="kw">do</span>
	glClear gl_COLOR_BUFFER_BIT
	glClear gl_DEPTH_BUFFER_BIT
	glUseProgram progId
	bindBufferToAttrib vertexBufferId <span class="dv">0</span>
	glDrawArrays gl_TRIANGLES <span class="dv">0</span> <span class="dv">3</span> <span class="co">-- for attrib array 0, draw 3 vertices</span>
	glDisableVertexAttribArray <span class="dv">0</span> <span class="co">-- disable attrib array 0</span></code></pre></td></tr></table>
<div class="raw-link">
<a  class="raw"  href= "/code/opengl/triangle.hs"  mimetype=text/plain > triangle.hs </a>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Seriously, why do so many Haskell tutorials omit function type signatures?<a href="#fnref1">↩</a></p></li>
</ol>
</div>
]]></summary>
</entry>

</feed>
